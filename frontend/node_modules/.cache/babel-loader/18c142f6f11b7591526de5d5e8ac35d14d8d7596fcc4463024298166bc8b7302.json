{"ast":null,"code":"import supabase from'./supabaseClient';// Auth methods\nexport const auth={// Register a new user\nregister:async userData=>{var _data$user;const{email,password,name,role,businessName,businessCategory,phone,address}=userData;// Create metadata\nconst metadata={name,role:role||'client',phone,businessName,businessCategory};const{data,error}=await supabase.auth.signUp({email,password,options:{data:metadata}});if(error){throw new Error(error.message);}// Additional profile data\nif(data!==null&&data!==void 0&&(_data$user=data.user)!==null&&_data$user!==void 0&&_data$user.id){if(role==='business'&&businessName){const{error:profileError}=await supabase.from('users').update({business_name:businessName,business_category:businessCategory}).eq('id',data.user.id);if(profileError){console.error('Error updating business profile:',profileError);}}if(address){const{error:addressError}=await supabase.from('users').update({street:address.street,city:address.city,state:address.state,zip_code:address.zipCode,country:address.country}).eq('id',data.user.id);if(addressError){console.error('Error updating address:',addressError);}}}return{user:{id:data.user.id,name,email:data.user.email,role:role||'client'},session:data.session};},// Sign in with email and password\nlogin:async credentials=>{var _data$user$user_metad,_data$user$user_metad2;const{email,password}=credentials;const{data,error}=await supabase.auth.signInWithPassword({email,password});if(error){throw new Error(error.message);}// Get user profile data\nconst{data:userData,error:profileError}=await supabase.from('users').select('*').eq('id',data.user.id).single();if(profileError){console.error('Error fetching user profile:',profileError);}return{user:{id:data.user.id,name:(userData===null||userData===void 0?void 0:userData.name)||((_data$user$user_metad=data.user.user_metadata)===null||_data$user$user_metad===void 0?void 0:_data$user$user_metad.name),email:data.user.email,role:(userData===null||userData===void 0?void 0:userData.role)||((_data$user$user_metad2=data.user.user_metadata)===null||_data$user$user_metad2===void 0?void 0:_data$user$user_metad2.role)||'client',isVerified:data.user.email_confirmed_at?true:false,avatar:userData===null||userData===void 0?void 0:userData.avatar_url,businessName:userData===null||userData===void 0?void 0:userData.business_name},session:data.session};},// Sign out\nlogout:async()=>{const{error}=await supabase.auth.signOut();if(error){throw new Error(error.message);}return true;},// Get the current session\ngetSession:async()=>{const{data,error}=await supabase.auth.getSession();if(error){throw new Error(error.message);}return data.session;},// Reset password\nresetPassword:async email=>{const{error}=await supabase.auth.resetPasswordForEmail(email,{redirectTo:`${window.location.origin}/reset-password`});if(error){throw new Error(error.message);}return true;},// Update password\nupdatePassword:async newPassword=>{const{error}=await supabase.auth.updateUser({password:newPassword});if(error){throw new Error(error.message);}return true;}};// User methods\nexport const users={// Get current user profile\ngetCurrentUser:async()=>{var _user$user_metadata,_user$user_metadata2;// First get the auth user\nconst{data:{user}}=await supabase.auth.getUser();if(!user){throw new Error('Not authenticated');}// Then get the profile data\nconst{data,error}=await supabase.from('users').select('*').eq('id',user.id).single();if(error){throw new Error(error.message);}return{id:user.id,name:data.name||((_user$user_metadata=user.user_metadata)===null||_user$user_metadata===void 0?void 0:_user$user_metadata.name),email:user.email,role:data.role||((_user$user_metadata2=user.user_metadata)===null||_user$user_metadata2===void 0?void 0:_user$user_metadata2.role)||'client',phone:data.phone,avatar:data.avatar_url,address:{street:data.street,city:data.city,state:data.state,zipCode:data.zip_code,country:data.country},businessName:data.business_name,businessCategory:data.business_category,businessDescription:data.business_description,website:data.website};},// Update user profile\nupdateProfile:async profileData=>{var _profileData$address,_profileData$address2,_profileData$address3,_profileData$address4,_profileData$address5;const{data:{user}}=await supabase.auth.getUser();if(!user){throw new Error('Not authenticated');}// Format data for Supabase\nconst updateData={name:profileData.name,phone:profileData.phone,street:(_profileData$address=profileData.address)===null||_profileData$address===void 0?void 0:_profileData$address.street,city:(_profileData$address2=profileData.address)===null||_profileData$address2===void 0?void 0:_profileData$address2.city,state:(_profileData$address3=profileData.address)===null||_profileData$address3===void 0?void 0:_profileData$address3.state,zip_code:(_profileData$address4=profileData.address)===null||_profileData$address4===void 0?void 0:_profileData$address4.zipCode,country:(_profileData$address5=profileData.address)===null||_profileData$address5===void 0?void 0:_profileData$address5.country};// Add business fields if needed\nif(profileData.businessName){updateData.business_name=profileData.businessName;updateData.business_category=profileData.businessCategory;updateData.business_description=profileData.businessDescription;updateData.website=profileData.website;}const{data,error}=await supabase.from('users').update(updateData).eq('id',user.id).select().single();if(error){throw new Error(error.message);}// Format the response to match the existing API format\nreturn{user:{id:user.id,name:data.name,email:user.email,role:data.role,phone:data.phone,avatar:data.avatar_url,address:{street:data.street,city:data.city,state:data.state,zipCode:data.zip_code,country:data.country},businessName:data.business_name,businessCategory:data.business_category,businessDescription:data.business_description,website:data.website}};},// Upload avatar\nuploadAvatar:async file=>{const{data:{user}}=await supabase.auth.getUser();if(!user){throw new Error('Not authenticated');}// Create a unique filename\nconst fileExt=file.name.split('.').pop();const fileName=`${user.id}/${Date.now()}.${fileExt}`;const filePath=`avatars/${fileName}`;// Upload to Supabase Storage\nconst{error:uploadError}=await supabase.storage.from('profiles').upload(filePath,file);if(uploadError){throw new Error(uploadError.message);}// Get the public URL\nconst{data:{publicUrl}}=supabase.storage.from('profiles').getPublicUrl(filePath);// Update user profile with avatar URL\nconst{error:updateError}=await supabase.from('users').update({avatar_url:publicUrl}).eq('id',user.id);if(updateError){throw new Error(updateError.message);}return publicUrl;}};// Pet methods\nexport const pets={// Get all pets for current user\ngetPets:async()=>{const{data:{user}}=await supabase.auth.getUser();if(!user){throw new Error('Not authenticated');}const{data,error}=await supabase.from('pets').select('*').eq('owner_id',user.id);if(error){throw new Error(error.message);}return data;},// Get a specific pet\ngetPet:async id=>{const{data,error}=await supabase.from('pets').select(`\n        *,\n        pet_emergency_contacts(*)\n      `).eq('id',id).single();if(error){throw new Error(error.message);}return data;},// Create a new pet\ncreatePet:async petData=>{const{data:{user}}=await supabase.auth.getUser();if(!user){throw new Error('Not authenticated');}// Format data for Supabase\nconst newPet={owner_id:user.id,name:petData.name,type:petData.type,breed:petData.breed,age:petData.age,gender:petData.gender,special_requirements:petData.specialRequirements};const{data,error}=await supabase.from('pets').insert(newPet).select().single();if(error){throw new Error(error.message);}// If emergency contacts were provided, add them\nif(petData.emergencyContacts&&petData.emergencyContacts.length>0){const emergencyContacts=petData.emergencyContacts.map(contact=>({pet_id:data.id,name:contact.name,phone:contact.phone,email:contact.email,relationship:contact.relationship}));const{error:contactsError}=await supabase.from('pet_emergency_contacts').insert(emergencyContacts);if(contactsError){console.error('Error adding emergency contacts:',contactsError);}}return data;},// Update an existing pet\nupdatePet:async(id,petData)=>{// Format data for Supabase\nconst updateData={name:petData.name,type:petData.type,breed:petData.breed,age:petData.age,gender:petData.gender,special_requirements:petData.specialRequirements};const{data,error}=await supabase.from('pets').update(updateData).eq('id',id).select().single();if(error){throw new Error(error.message);}// If emergency contacts were provided, update them\nif(petData.emergencyContacts&&petData.emergencyContacts.length>0){// First delete existing contacts\nconst{error:deleteError}=await supabase.from('pet_emergency_contacts').delete().eq('pet_id',id);if(deleteError){console.error('Error deleting emergency contacts:',deleteError);}// Then add new ones\nconst emergencyContacts=petData.emergencyContacts.map(contact=>({pet_id:id,name:contact.name,phone:contact.phone,email:contact.email,relationship:contact.relationship}));const{error:contactsError}=await supabase.from('pet_emergency_contacts').insert(emergencyContacts);if(contactsError){console.error('Error adding emergency contacts:',contactsError);}}return data;},// Delete a pet\ndeletePet:async id=>{const{error}=await supabase.from('pets').delete().eq('id',id);if(error){throw new Error(error.message);}return true;},// Upload pet photo\nuploadPetPhoto:async(id,file)=>{// Create a unique filename\nconst fileExt=file.name.split('.').pop();const fileName=`${id}/${Date.now()}.${fileExt}`;const filePath=`pets/${fileName}`;// Upload to Supabase Storage\nconst{error:uploadError}=await supabase.storage.from('pet-photos').upload(filePath,file);if(uploadError){throw new Error(uploadError.message);}// Get the public URL\nconst{data:{publicUrl}}=supabase.storage.from('pet-photos').getPublicUrl(filePath);// Update pet with photo URL\nconst{error:updateError}=await supabase.from('pets').update({photo_url:publicUrl}).eq('id',id);if(updateError){throw new Error(updateError.message);}return publicUrl;}};// Service methods\nexport const services={// Get all services with optional filters\ngetServices:async params=>{let query=supabase.from('services').select('*');// Apply filters if provided\nif(params){if(params.providerId){query=query.eq('provider_id',params.providerId);}if(params.category){query=query.eq('category',params.category);}}const{data,error}=await query;if(error){throw new Error(error.message);}return data;},// Get a specific service with all related data\ngetService:async id=>{const{data:service,error:serviceError}=await supabase.from('services').select('*').eq('id',id).single();if(serviceError){throw new Error(serviceError.message);}// Get availability\nconst{data:availability,error:availabilityError}=await supabase.from('service_availability').select('*').eq('service_id',id);if(availabilityError){console.error('Error fetching availability:',availabilityError);}// Get custom form schema if exists\nconst{data:customForm,error:formError}=await supabase.from('service_custom_forms').select('*').eq('service_id',id).maybeSingle();if(formError&&formError.code!=='PGRST116'){console.error('Error fetching custom form:',formError);}return{...service,availability:availability||[],customForm:customForm?customForm.form_schema:null};},// Create a new service\ncreateService:async serviceData=>{const{data:{user}}=await supabase.auth.getUser();if(!user){throw new Error('Not authenticated');}// Format data for Supabase\nconst newService={provider_id:user.id,title:serviceData.title,description:serviceData.description,category:serviceData.category,price_amount:serviceData.price.amount,price_currency:serviceData.price.currency||'USD',duration:serviceData.duration,location_options:serviceData.locationOptions,capacity:serviceData.capacity||1,buffer_time:serviceData.bufferTime||0};const{data,error}=await supabase.from('services').insert(newService).select().single();if(error){throw new Error(error.message);}// Add availability if provided\nif(serviceData.availability&&serviceData.availability.length>0){const availability=serviceData.availability.map(slot=>({service_id:data.id,day_of_week:slot.dayOfWeek,specific_date:slot.specificDate,start_time:slot.startTime,end_time:slot.endTime,is_available:slot.isAvailable!==false}));const{error:availabilityError}=await supabase.from('service_availability').insert(availability);if(availabilityError){console.error('Error adding availability:',availabilityError);}}// Add custom form if provided\nif(serviceData.customForm){const{error:formError}=await supabase.from('service_custom_forms').insert({service_id:data.id,form_schema:serviceData.customForm});if(formError){console.error('Error adding custom form:',formError);}}return data;},// Update an existing service\nupdateService:async(id,serviceData)=>{// Format data for Supabase\nconst updateData={title:serviceData.title,description:serviceData.description,category:serviceData.category,price_amount:serviceData.price.amount,price_currency:serviceData.price.currency||'USD',duration:serviceData.duration,location_options:serviceData.locationOptions,capacity:serviceData.capacity||1,buffer_time:serviceData.bufferTime||0};const{data,error}=await supabase.from('services').update(updateData).eq('id',id).select().single();if(error){throw new Error(error.message);}// Update availability if provided\nif(serviceData.availability&&serviceData.availability.length>0){// First delete existing availability\nconst{error:deleteError}=await supabase.from('service_availability').delete().eq('service_id',id);if(deleteError){console.error('Error deleting availability:',deleteError);}// Then add new availability\nconst availability=serviceData.availability.map(slot=>({service_id:id,day_of_week:slot.dayOfWeek,specific_date:slot.specificDate,start_time:slot.startTime,end_time:slot.endTime,is_available:slot.isAvailable!==false}));const{error:availabilityError}=await supabase.from('service_availability').insert(availability);if(availabilityError){console.error('Error adding availability:',availabilityError);}}// Update custom form if provided\nif(serviceData.customForm){// Check if form already exists\nconst{data:existingForm,error:checkError}=await supabase.from('service_custom_forms').select('id').eq('service_id',id).maybeSingle();if(checkError&&checkError.code!=='PGRST116'){console.error('Error checking custom form:',checkError);}if(existingForm){// Update existing form\nconst{error:updateError}=await supabase.from('service_custom_forms').update({form_schema:serviceData.customForm}).eq('id',existingForm.id);if(updateError){console.error('Error updating custom form:',updateError);}}else{// Insert new form\nconst{error:insertError}=await supabase.from('service_custom_forms').insert({service_id:id,form_schema:serviceData.customForm});if(insertError){console.error('Error adding custom form:',insertError);}}}return data;},// Delete a service\ndeleteService:async id=>{const{error}=await supabase.from('services').delete().eq('id',id);if(error){throw new Error(error.message);}return true;}};// Booking methods\nexport const bookings={// Get all bookings with filters\ngetBookings:async params=>{var _user$user_metadata3,_user$user_metadata4;const{data:{user}}=await supabase.auth.getUser();if(!user){throw new Error('Not authenticated');}let query=supabase.from('bookings').select(`\n        *,\n        services(title, description, price_amount, price_currency),\n        pets(name, type, breed)\n      `);// Apply filters based on user role and params\nif(((_user$user_metadata3=user.user_metadata)===null||_user$user_metadata3===void 0?void 0:_user$user_metadata3.role)==='client'){query=query.eq('client_id',user.id);}else if(((_user$user_metadata4=user.user_metadata)===null||_user$user_metadata4===void 0?void 0:_user$user_metadata4.role)==='business'){query=query.eq('provider_id',user.id);}if(params){if(params.status){query=query.eq('status',params.status);}if(params.startDate&&params.endDate){query=query.gte('start_time',params.startDate).lte('start_time',params.endDate);}}// Order by start time, newest first\nquery=query.order('start_time',{ascending:false});const{data,error}=await query;if(error){throw new Error(error.message);}return data;},// Get a specific booking\ngetBooking:async id=>{const{data,error}=await supabase.from('bookings').select(`\n        *,\n        services(*),\n        reviews(*)\n      `).eq('id',id).single();if(error){throw new Error(error.message);}return data;},// Create a new booking\ncreateBooking:async bookingData=>{var _bookingData$notes,_bookingData$notes2,_bookingData$notes3;const{data:{user}}=await supabase.auth.getUser();if(!user){throw new Error('Not authenticated');}// Get service to verify provider and price\nconst{data:service,error:serviceError}=await supabase.from('services').select('provider_id, price_amount, price_currency').eq('id',bookingData.serviceId).single();if(serviceError){throw new Error('Service not found');}// Format booking data for Supabase\nconst newBooking={service_id:bookingData.serviceId,provider_id:bookingData.providerId||service.provider_id,client_id:user.id,pet_id:bookingData.petId,start_time:new Date(bookingData.startTime).toISOString(),end_time:new Date(bookingData.endTime).toISOString(),location:bookingData.location,total_price_amount:service.price_amount,total_price_currency:service.price_currency||'USD',client_notes:((_bookingData$notes=bookingData.notes)===null||_bookingData$notes===void 0?void 0:_bookingData$notes.client)||null,provider_notes:((_bookingData$notes2=bookingData.notes)===null||_bookingData$notes2===void 0?void 0:_bookingData$notes2.provider)||null,internal_notes:((_bookingData$notes3=bookingData.notes)===null||_bookingData$notes3===void 0?void 0:_bookingData$notes3.internal)||null,custom_form_data:bookingData.customFormData||null,status:'pending'};const{data,error}=await supabase.from('bookings').insert(newBooking).select().single();if(error){throw new Error(error.message);}return data;},// Update an existing booking\nupdateBooking:async(id,bookingData)=>{// Format data for Supabase\nconst updateData={};if(bookingData.startTime){updateData.start_time=new Date(bookingData.startTime).toISOString();}if(bookingData.endTime){updateData.end_time=new Date(bookingData.endTime).toISOString();}if(bookingData.status){updateData.status=bookingData.status;}if(bookingData.notes){if(bookingData.notes.client!==undefined){updateData.client_notes=bookingData.notes.client;}if(bookingData.notes.provider!==undefined){updateData.provider_notes=bookingData.notes.provider;}if(bookingData.notes.internal!==undefined){updateData.internal_notes=bookingData.notes.internal;}}if(bookingData.assignedStaff){updateData.assigned_staff_id=bookingData.assignedStaff;}const{data,error}=await supabase.from('bookings').update(updateData).eq('id',id).select().single();if(error){throw new Error(error.message);}return data;},// Cancel a booking\ncancelBooking:async(id,reason)=>{var _user$user_metadata5;const{data:{user}}=await supabase.auth.getUser();if(!user){throw new Error('Not authenticated');}// Get booking to determine who is cancelling\nconst{data:booking,error:bookingError}=await supabase.from('bookings').select('client_id, provider_id').eq('id',id).single();if(bookingError){throw new Error('Booking not found');}// Determine who is cancelling\nlet cancellationBy;if(booking.client_id===user.id){cancellationBy='client';}else if(booking.provider_id===user.id){cancellationBy='provider';}else if(((_user$user_metadata5=user.user_metadata)===null||_user$user_metadata5===void 0?void 0:_user$user_metadata5.role)==='admin'){cancellationBy='admin';}else{throw new Error('Not authorized to cancel this booking');}// Update booking\nconst{data,error}=await supabase.from('bookings').update({status:'cancelled',cancellation_reason:reason||'No reason provided',cancellation_time:new Date().toISOString(),cancellation_by:cancellationBy}).eq('id',id).select().single();if(error){throw new Error(error.message);}return data;},// Mark a booking as completed\ncompleteBooking:async id=>{const{data,error}=await supabase.from('bookings').update({status:'completed'}).eq('id',id).select().single();if(error){throw new Error(error.message);}return data;},// Add a review to a booking\naddReview:async(bookingId,reviewData)=>{const{data:{user}}=await supabase.auth.getUser();if(!user){throw new Error('Not authenticated');}// Get booking to verify client and provider\nconst{data:booking,error:bookingError}=await supabase.from('bookings').select('client_id, provider_id, status').eq('id',bookingId).single();if(bookingError){throw new Error('Booking not found');}// Verify client is adding the review\nif(booking.client_id!==user.id){throw new Error('Not authorized to review this booking');}// Verify booking is completed\nif(booking.status!=='completed'){throw new Error('Can only review completed bookings');}// Create the review\nconst newReview={booking_id:bookingId,client_id:user.id,provider_id:booking.provider_id,rating:reviewData.rating,comment:reviewData.comment||''};const{data,error}=await supabase.from('reviews').insert(newReview).select().single();if(error){throw new Error(error.message);}return data;}};// Payment methods\nexport const payments={// Create a payment intent\ncreatePaymentIntent:async bookingId=>{// For now, we'll just make an API call to the existing endpoint\n// This would ideally be replaced with a direct Supabase Edge Function call\nconst{data:{session}}=await supabase.auth.getSession();if(!session){throw new Error('Not authenticated');}const response=await fetch(`${process.env.REACT_APP_API_URL||'http://localhost:5000/api'}/payments/create-intent`,{method:'POST',headers:{'Content-Type':'application/json','Authorization':`Bearer ${session.access_token}`},body:JSON.stringify({bookingId})});const data=await response.json();if(!response.ok){throw new Error(data.error||'Failed to create payment intent');}return data;}};// Widget integration methods\nexport const widget={// Generate an API key\ngenerateApiKey:async keyName=>{const{data:{user}}=await supabase.auth.getUser();if(!user){throw new Error('Not authenticated');}// Call the RPC function to generate an API key\nconst{data,error}=await supabase.rpc('generate_api_key',{business_id:user.id,key_name:keyName||'Widget API Key'});if(error){throw new Error(error.message);}return data;},// Get embed code\ngetEmbedCode:async function(){let options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};const{data:{user}}=await supabase.auth.getUser();if(!user){throw new Error('Not authenticated');}// Get API keys\nconst{data:apiKeys,error:keysError}=await supabase.from('api_keys').select('key_value').eq('business_id',user.id).limit(1);if(keysError||!apiKeys||apiKeys.length===0){throw new Error('API key not found. Generate one first.');}// Get widget settings\nconst{data:widgetSettings,error:settingsError}=await supabase.from('widget_settings').select('*').eq('business_id',user.id).maybeSingle();if(settingsError&&settingsError.code!=='PGRST116'){console.error('Error fetching widget settings:',settingsError);}// Get user data\nconst{data:userData,error:userError}=await supabase.from('users').select('business_name, name').eq('id',user.id).single();if(userError){console.error('Error fetching user data:',userError);}// Merge options with settings\nconst settings={...(widgetSettings||{}),...options};// Generate the embed code\nconst serverUrl=process.env.REACT_APP_API_URL||'http://localhost:5000';const businessName=(userData===null||userData===void 0?void 0:userData.business_name)||(userData===null||userData===void 0?void 0:userData.name)||'Our Business';const embedCode=`\n<div id=\"dog-services-widget\"></div>\n<script>\n  (function() {\n    const script = document.createElement('script');\n    script.src = \"${serverUrl}/widget.js\";\n    script.async = true;\n    script.onload = function() {\n      DogServicesWidget.init({\n        apiKey: \"${apiKeys[0].key_value}\",\n        containerId: \"dog-services-widget\",\n        businessName: \"${businessName}\",\n        primaryColor: \"${settings.primary_color||'#4F46E5'}\",\n        secondaryColor: \"${settings.secondary_color||'#10B981'}\",\n        fontFamily: \"${settings.font_family||'sans-serif'}\",\n        borderRadius: \"${settings.border_radius||'8px'}\",\n        layout: \"${settings.layout||'default'}\"\n      });\n    };\n    document.head.appendChild(script);\n  })();\n</script>\n`;return embedCode;},// Get services for widget\ngetWidgetServices:async apiKey=>{// Validate API key\nconst{data:keyData,error:keyError}=await supabase.from('api_keys').select('business_id').eq('key_value',apiKey).single();if(keyError){throw new Error('Invalid API key');}// Get business services\nconst{data,error}=await supabase.from('services').select('*').eq('provider_id',keyData.business_id);if(error){throw new Error(error.message);}return data;}};// The primary export is used for compatibility with the existing API service\nexport default{auth,users,pets,services,bookings,payments,widget};","map":{"version":3,"names":["supabase","auth","register","userData","_data$user","email","password","name","role","businessName","businessCategory","phone","address","metadata","data","error","signUp","options","Error","message","user","id","profileError","from","update","business_name","business_category","eq","console","addressError","street","city","state","zip_code","zipCode","country","session","login","credentials","_data$user$user_metad","_data$user$user_metad2","signInWithPassword","select","single","user_metadata","isVerified","email_confirmed_at","avatar","avatar_url","logout","signOut","getSession","resetPassword","resetPasswordForEmail","redirectTo","window","location","origin","updatePassword","newPassword","updateUser","users","getCurrentUser","_user$user_metadata","_user$user_metadata2","getUser","businessDescription","business_description","website","updateProfile","profileData","_profileData$address","_profileData$address2","_profileData$address3","_profileData$address4","_profileData$address5","updateData","uploadAvatar","file","fileExt","split","pop","fileName","Date","now","filePath","uploadError","storage","upload","publicUrl","getPublicUrl","updateError","pets","getPets","getPet","createPet","petData","newPet","owner_id","type","breed","age","gender","special_requirements","specialRequirements","insert","emergencyContacts","length","map","contact","pet_id","relationship","contactsError","updatePet","deleteError","delete","deletePet","uploadPetPhoto","photo_url","services","getServices","params","query","providerId","category","getService","service","serviceError","availability","availabilityError","customForm","formError","maybeSingle","code","form_schema","createService","serviceData","newService","provider_id","title","description","price_amount","price","amount","price_currency","currency","duration","location_options","locationOptions","capacity","buffer_time","bufferTime","slot","service_id","day_of_week","dayOfWeek","specific_date","specificDate","start_time","startTime","end_time","endTime","is_available","isAvailable","updateService","existingForm","checkError","insertError","deleteService","bookings","getBookings","_user$user_metadata3","_user$user_metadata4","status","startDate","endDate","gte","lte","order","ascending","getBooking","createBooking","bookingData","_bookingData$notes","_bookingData$notes2","_bookingData$notes3","serviceId","newBooking","client_id","petId","toISOString","total_price_amount","total_price_currency","client_notes","notes","client","provider_notes","provider","internal_notes","internal","custom_form_data","customFormData","updateBooking","undefined","assignedStaff","assigned_staff_id","cancelBooking","reason","_user$user_metadata5","booking","bookingError","cancellationBy","cancellation_reason","cancellation_time","cancellation_by","completeBooking","addReview","bookingId","reviewData","newReview","booking_id","rating","comment","payments","createPaymentIntent","response","fetch","process","env","REACT_APP_API_URL","method","headers","access_token","body","JSON","stringify","json","ok","widget","generateApiKey","keyName","rpc","business_id","key_name","getEmbedCode","arguments","apiKeys","keysError","limit","widgetSettings","settingsError","userError","settings","serverUrl","embedCode","key_value","primary_color","secondary_color","font_family","border_radius","layout","getWidgetServices","apiKey","keyData","keyError"],"sources":["/home/toebot/dog-services-saas/frontend/src/services/supabaseService.js"],"sourcesContent":["import supabase from './supabaseClient';\n\n// Auth methods\nexport const auth = {\n  // Register a new user\n  register: async (userData) => {\n    const { email, password, name, role, businessName, businessCategory, phone, address } = userData;\n    \n    // Create metadata\n    const metadata = {\n      name,\n      role: role || 'client',\n      phone,\n      businessName,\n      businessCategory\n    };\n    \n    const { data, error } = await supabase.auth.signUp({\n      email,\n      password,\n      options: {\n        data: metadata\n      }\n    });\n    \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    // Additional profile data\n    if (data?.user?.id) {\n      if (role === 'business' && businessName) {\n        const { error: profileError } = await supabase\n          .from('users')\n          .update({\n            business_name: businessName,\n            business_category: businessCategory\n          })\n          .eq('id', data.user.id);\n          \n        if (profileError) {\n          console.error('Error updating business profile:', profileError);\n        }\n      }\n      \n      if (address) {\n        const { error: addressError } = await supabase\n          .from('users')\n          .update({\n            street: address.street,\n            city: address.city,\n            state: address.state,\n            zip_code: address.zipCode,\n            country: address.country\n          })\n          .eq('id', data.user.id);\n          \n        if (addressError) {\n          console.error('Error updating address:', addressError);\n        }\n      }\n    }\n    \n    return { \n      user: {\n        id: data.user.id,\n        name,\n        email: data.user.email,\n        role: role || 'client',\n      },\n      session: data.session\n    };\n  },\n  \n  // Sign in with email and password\n  login: async (credentials) => {\n    const { email, password } = credentials;\n    \n    const { data, error } = await supabase.auth.signInWithPassword({\n      email,\n      password\n    });\n    \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    // Get user profile data\n    const { data: userData, error: profileError } = await supabase\n      .from('users')\n      .select('*')\n      .eq('id', data.user.id)\n      .single();\n      \n    if (profileError) {\n      console.error('Error fetching user profile:', profileError);\n    }\n    \n    return {\n      user: {\n        id: data.user.id,\n        name: userData?.name || data.user.user_metadata?.name,\n        email: data.user.email,\n        role: userData?.role || data.user.user_metadata?.role || 'client',\n        isVerified: data.user.email_confirmed_at ? true : false,\n        avatar: userData?.avatar_url,\n        businessName: userData?.business_name\n      },\n      session: data.session\n    };\n  },\n  \n  // Sign out\n  logout: async () => {\n    const { error } = await supabase.auth.signOut();\n    \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return true;\n  },\n  \n  // Get the current session\n  getSession: async () => {\n    const { data, error } = await supabase.auth.getSession();\n    \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return data.session;\n  },\n  \n  // Reset password\n  resetPassword: async (email) => {\n    const { error } = await supabase.auth.resetPasswordForEmail(email, {\n      redirectTo: `${window.location.origin}/reset-password`\n    });\n    \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return true;\n  },\n  \n  // Update password\n  updatePassword: async (newPassword) => {\n    const { error } = await supabase.auth.updateUser({\n      password: newPassword\n    });\n    \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return true;\n  }\n};\n\n// User methods\nexport const users = {\n  // Get current user profile\n  getCurrentUser: async () => {\n    // First get the auth user\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n    \n    // Then get the profile data\n    const { data, error } = await supabase\n      .from('users')\n      .select('*')\n      .eq('id', user.id)\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return {\n      id: user.id,\n      name: data.name || user.user_metadata?.name,\n      email: user.email,\n      role: data.role || user.user_metadata?.role || 'client',\n      phone: data.phone,\n      avatar: data.avatar_url,\n      address: {\n        street: data.street,\n        city: data.city,\n        state: data.state,\n        zipCode: data.zip_code,\n        country: data.country\n      },\n      businessName: data.business_name,\n      businessCategory: data.business_category,\n      businessDescription: data.business_description,\n      website: data.website\n    };\n  },\n  \n  // Update user profile\n  updateProfile: async (profileData) => {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n    \n    // Format data for Supabase\n    const updateData = {\n      name: profileData.name,\n      phone: profileData.phone,\n      street: profileData.address?.street,\n      city: profileData.address?.city,\n      state: profileData.address?.state,\n      zip_code: profileData.address?.zipCode,\n      country: profileData.address?.country\n    };\n    \n    // Add business fields if needed\n    if (profileData.businessName) {\n      updateData.business_name = profileData.businessName;\n      updateData.business_category = profileData.businessCategory;\n      updateData.business_description = profileData.businessDescription;\n      updateData.website = profileData.website;\n    }\n    \n    const { data, error } = await supabase\n      .from('users')\n      .update(updateData)\n      .eq('id', user.id)\n      .select()\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    // Format the response to match the existing API format\n    return {\n      user: {\n        id: user.id,\n        name: data.name,\n        email: user.email,\n        role: data.role,\n        phone: data.phone,\n        avatar: data.avatar_url,\n        address: {\n          street: data.street,\n          city: data.city,\n          state: data.state,\n          zipCode: data.zip_code,\n          country: data.country\n        },\n        businessName: data.business_name,\n        businessCategory: data.business_category,\n        businessDescription: data.business_description,\n        website: data.website\n      }\n    };\n  },\n  \n  // Upload avatar\n  uploadAvatar: async (file) => {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n    \n    // Create a unique filename\n    const fileExt = file.name.split('.').pop();\n    const fileName = `${user.id}/${Date.now()}.${fileExt}`;\n    const filePath = `avatars/${fileName}`;\n    \n    // Upload to Supabase Storage\n    const { error: uploadError } = await supabase.storage\n      .from('profiles')\n      .upload(filePath, file);\n      \n    if (uploadError) {\n      throw new Error(uploadError.message);\n    }\n    \n    // Get the public URL\n    const { data: { publicUrl } } = supabase.storage\n      .from('profiles')\n      .getPublicUrl(filePath);\n      \n    // Update user profile with avatar URL\n    const { error: updateError } = await supabase\n      .from('users')\n      .update({ avatar_url: publicUrl })\n      .eq('id', user.id);\n      \n    if (updateError) {\n      throw new Error(updateError.message);\n    }\n    \n    return publicUrl;\n  }\n};\n\n// Pet methods\nexport const pets = {\n  // Get all pets for current user\n  getPets: async () => {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n    \n    const { data, error } = await supabase\n      .from('pets')\n      .select('*')\n      .eq('owner_id', user.id);\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return data;\n  },\n  \n  // Get a specific pet\n  getPet: async (id) => {\n    const { data, error } = await supabase\n      .from('pets')\n      .select(`\n        *,\n        pet_emergency_contacts(*)\n      `)\n      .eq('id', id)\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return data;\n  },\n  \n  // Create a new pet\n  createPet: async (petData) => {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n    \n    // Format data for Supabase\n    const newPet = {\n      owner_id: user.id,\n      name: petData.name,\n      type: petData.type,\n      breed: petData.breed,\n      age: petData.age,\n      gender: petData.gender,\n      special_requirements: petData.specialRequirements\n    };\n    \n    const { data, error } = await supabase\n      .from('pets')\n      .insert(newPet)\n      .select()\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    // If emergency contacts were provided, add them\n    if (petData.emergencyContacts && petData.emergencyContacts.length > 0) {\n      const emergencyContacts = petData.emergencyContacts.map(contact => ({\n        pet_id: data.id,\n        name: contact.name,\n        phone: contact.phone,\n        email: contact.email,\n        relationship: contact.relationship\n      }));\n      \n      const { error: contactsError } = await supabase\n        .from('pet_emergency_contacts')\n        .insert(emergencyContacts);\n        \n      if (contactsError) {\n        console.error('Error adding emergency contacts:', contactsError);\n      }\n    }\n    \n    return data;\n  },\n  \n  // Update an existing pet\n  updatePet: async (id, petData) => {\n    // Format data for Supabase\n    const updateData = {\n      name: petData.name,\n      type: petData.type,\n      breed: petData.breed,\n      age: petData.age,\n      gender: petData.gender,\n      special_requirements: petData.specialRequirements\n    };\n    \n    const { data, error } = await supabase\n      .from('pets')\n      .update(updateData)\n      .eq('id', id)\n      .select()\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    // If emergency contacts were provided, update them\n    if (petData.emergencyContacts && petData.emergencyContacts.length > 0) {\n      // First delete existing contacts\n      const { error: deleteError } = await supabase\n        .from('pet_emergency_contacts')\n        .delete()\n        .eq('pet_id', id);\n        \n      if (deleteError) {\n        console.error('Error deleting emergency contacts:', deleteError);\n      }\n      \n      // Then add new ones\n      const emergencyContacts = petData.emergencyContacts.map(contact => ({\n        pet_id: id,\n        name: contact.name,\n        phone: contact.phone,\n        email: contact.email,\n        relationship: contact.relationship\n      }));\n      \n      const { error: contactsError } = await supabase\n        .from('pet_emergency_contacts')\n        .insert(emergencyContacts);\n        \n      if (contactsError) {\n        console.error('Error adding emergency contacts:', contactsError);\n      }\n    }\n    \n    return data;\n  },\n  \n  // Delete a pet\n  deletePet: async (id) => {\n    const { error } = await supabase\n      .from('pets')\n      .delete()\n      .eq('id', id);\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return true;\n  },\n  \n  // Upload pet photo\n  uploadPetPhoto: async (id, file) => {\n    // Create a unique filename\n    const fileExt = file.name.split('.').pop();\n    const fileName = `${id}/${Date.now()}.${fileExt}`;\n    const filePath = `pets/${fileName}`;\n    \n    // Upload to Supabase Storage\n    const { error: uploadError } = await supabase.storage\n      .from('pet-photos')\n      .upload(filePath, file);\n      \n    if (uploadError) {\n      throw new Error(uploadError.message);\n    }\n    \n    // Get the public URL\n    const { data: { publicUrl } } = supabase.storage\n      .from('pet-photos')\n      .getPublicUrl(filePath);\n      \n    // Update pet with photo URL\n    const { error: updateError } = await supabase\n      .from('pets')\n      .update({ photo_url: publicUrl })\n      .eq('id', id);\n      \n    if (updateError) {\n      throw new Error(updateError.message);\n    }\n    \n    return publicUrl;\n  }\n};\n\n// Service methods\nexport const services = {\n  // Get all services with optional filters\n  getServices: async (params) => {\n    let query = supabase\n      .from('services')\n      .select('*');\n      \n    // Apply filters if provided\n    if (params) {\n      if (params.providerId) {\n        query = query.eq('provider_id', params.providerId);\n      }\n      \n      if (params.category) {\n        query = query.eq('category', params.category);\n      }\n    }\n    \n    const { data, error } = await query;\n    \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return data;\n  },\n  \n  // Get a specific service with all related data\n  getService: async (id) => {\n    const { data: service, error: serviceError } = await supabase\n      .from('services')\n      .select('*')\n      .eq('id', id)\n      .single();\n      \n    if (serviceError) {\n      throw new Error(serviceError.message);\n    }\n    \n    // Get availability\n    const { data: availability, error: availabilityError } = await supabase\n      .from('service_availability')\n      .select('*')\n      .eq('service_id', id);\n      \n    if (availabilityError) {\n      console.error('Error fetching availability:', availabilityError);\n    }\n    \n    // Get custom form schema if exists\n    const { data: customForm, error: formError } = await supabase\n      .from('service_custom_forms')\n      .select('*')\n      .eq('service_id', id)\n      .maybeSingle();\n      \n    if (formError && formError.code !== 'PGRST116') {\n      console.error('Error fetching custom form:', formError);\n    }\n    \n    return {\n      ...service,\n      availability: availability || [],\n      customForm: customForm ? customForm.form_schema : null\n    };\n  },\n  \n  // Create a new service\n  createService: async (serviceData) => {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n    \n    // Format data for Supabase\n    const newService = {\n      provider_id: user.id,\n      title: serviceData.title,\n      description: serviceData.description,\n      category: serviceData.category,\n      price_amount: serviceData.price.amount,\n      price_currency: serviceData.price.currency || 'USD',\n      duration: serviceData.duration,\n      location_options: serviceData.locationOptions,\n      capacity: serviceData.capacity || 1,\n      buffer_time: serviceData.bufferTime || 0\n    };\n    \n    const { data, error } = await supabase\n      .from('services')\n      .insert(newService)\n      .select()\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    // Add availability if provided\n    if (serviceData.availability && serviceData.availability.length > 0) {\n      const availability = serviceData.availability.map(slot => ({\n        service_id: data.id,\n        day_of_week: slot.dayOfWeek,\n        specific_date: slot.specificDate,\n        start_time: slot.startTime,\n        end_time: slot.endTime,\n        is_available: slot.isAvailable !== false\n      }));\n      \n      const { error: availabilityError } = await supabase\n        .from('service_availability')\n        .insert(availability);\n        \n      if (availabilityError) {\n        console.error('Error adding availability:', availabilityError);\n      }\n    }\n    \n    // Add custom form if provided\n    if (serviceData.customForm) {\n      const { error: formError } = await supabase\n        .from('service_custom_forms')\n        .insert({\n          service_id: data.id,\n          form_schema: serviceData.customForm\n        });\n        \n      if (formError) {\n        console.error('Error adding custom form:', formError);\n      }\n    }\n    \n    return data;\n  },\n  \n  // Update an existing service\n  updateService: async (id, serviceData) => {\n    // Format data for Supabase\n    const updateData = {\n      title: serviceData.title,\n      description: serviceData.description,\n      category: serviceData.category,\n      price_amount: serviceData.price.amount,\n      price_currency: serviceData.price.currency || 'USD',\n      duration: serviceData.duration,\n      location_options: serviceData.locationOptions,\n      capacity: serviceData.capacity || 1,\n      buffer_time: serviceData.bufferTime || 0\n    };\n    \n    const { data, error } = await supabase\n      .from('services')\n      .update(updateData)\n      .eq('id', id)\n      .select()\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    // Update availability if provided\n    if (serviceData.availability && serviceData.availability.length > 0) {\n      // First delete existing availability\n      const { error: deleteError } = await supabase\n        .from('service_availability')\n        .delete()\n        .eq('service_id', id);\n        \n      if (deleteError) {\n        console.error('Error deleting availability:', deleteError);\n      }\n      \n      // Then add new availability\n      const availability = serviceData.availability.map(slot => ({\n        service_id: id,\n        day_of_week: slot.dayOfWeek,\n        specific_date: slot.specificDate,\n        start_time: slot.startTime,\n        end_time: slot.endTime,\n        is_available: slot.isAvailable !== false\n      }));\n      \n      const { error: availabilityError } = await supabase\n        .from('service_availability')\n        .insert(availability);\n        \n      if (availabilityError) {\n        console.error('Error adding availability:', availabilityError);\n      }\n    }\n    \n    // Update custom form if provided\n    if (serviceData.customForm) {\n      // Check if form already exists\n      const { data: existingForm, error: checkError } = await supabase\n        .from('service_custom_forms')\n        .select('id')\n        .eq('service_id', id)\n        .maybeSingle();\n        \n      if (checkError && checkError.code !== 'PGRST116') {\n        console.error('Error checking custom form:', checkError);\n      }\n      \n      if (existingForm) {\n        // Update existing form\n        const { error: updateError } = await supabase\n          .from('service_custom_forms')\n          .update({ form_schema: serviceData.customForm })\n          .eq('id', existingForm.id);\n          \n        if (updateError) {\n          console.error('Error updating custom form:', updateError);\n        }\n      } else {\n        // Insert new form\n        const { error: insertError } = await supabase\n          .from('service_custom_forms')\n          .insert({\n            service_id: id,\n            form_schema: serviceData.customForm\n          });\n          \n        if (insertError) {\n          console.error('Error adding custom form:', insertError);\n        }\n      }\n    }\n    \n    return data;\n  },\n  \n  // Delete a service\n  deleteService: async (id) => {\n    const { error } = await supabase\n      .from('services')\n      .delete()\n      .eq('id', id);\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return true;\n  }\n};\n\n// Booking methods\nexport const bookings = {\n  // Get all bookings with filters\n  getBookings: async (params) => {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n    \n    let query = supabase\n      .from('bookings')\n      .select(`\n        *,\n        services(title, description, price_amount, price_currency),\n        pets(name, type, breed)\n      `);\n      \n    // Apply filters based on user role and params\n    if (user.user_metadata?.role === 'client') {\n      query = query.eq('client_id', user.id);\n    } else if (user.user_metadata?.role === 'business') {\n      query = query.eq('provider_id', user.id);\n    }\n    \n    if (params) {\n      if (params.status) {\n        query = query.eq('status', params.status);\n      }\n      \n      if (params.startDate && params.endDate) {\n        query = query\n          .gte('start_time', params.startDate)\n          .lte('start_time', params.endDate);\n      }\n    }\n    \n    // Order by start time, newest first\n    query = query.order('start_time', { ascending: false });\n    \n    const { data, error } = await query;\n    \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return data;\n  },\n  \n  // Get a specific booking\n  getBooking: async (id) => {\n    const { data, error } = await supabase\n      .from('bookings')\n      .select(`\n        *,\n        services(*),\n        reviews(*)\n      `)\n      .eq('id', id)\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return data;\n  },\n  \n  // Create a new booking\n  createBooking: async (bookingData) => {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n    \n    // Get service to verify provider and price\n    const { data: service, error: serviceError } = await supabase\n      .from('services')\n      .select('provider_id, price_amount, price_currency')\n      .eq('id', bookingData.serviceId)\n      .single();\n      \n    if (serviceError) {\n      throw new Error('Service not found');\n    }\n    \n    // Format booking data for Supabase\n    const newBooking = {\n      service_id: bookingData.serviceId,\n      provider_id: bookingData.providerId || service.provider_id,\n      client_id: user.id,\n      pet_id: bookingData.petId,\n      start_time: new Date(bookingData.startTime).toISOString(),\n      end_time: new Date(bookingData.endTime).toISOString(),\n      location: bookingData.location,\n      total_price_amount: service.price_amount,\n      total_price_currency: service.price_currency || 'USD',\n      client_notes: bookingData.notes?.client || null,\n      provider_notes: bookingData.notes?.provider || null,\n      internal_notes: bookingData.notes?.internal || null,\n      custom_form_data: bookingData.customFormData || null,\n      status: 'pending'\n    };\n    \n    const { data, error } = await supabase\n      .from('bookings')\n      .insert(newBooking)\n      .select()\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return data;\n  },\n  \n  // Update an existing booking\n  updateBooking: async (id, bookingData) => {\n    // Format data for Supabase\n    const updateData = {};\n    \n    if (bookingData.startTime) {\n      updateData.start_time = new Date(bookingData.startTime).toISOString();\n    }\n    \n    if (bookingData.endTime) {\n      updateData.end_time = new Date(bookingData.endTime).toISOString();\n    }\n    \n    if (bookingData.status) {\n      updateData.status = bookingData.status;\n    }\n    \n    if (bookingData.notes) {\n      if (bookingData.notes.client !== undefined) {\n        updateData.client_notes = bookingData.notes.client;\n      }\n      \n      if (bookingData.notes.provider !== undefined) {\n        updateData.provider_notes = bookingData.notes.provider;\n      }\n      \n      if (bookingData.notes.internal !== undefined) {\n        updateData.internal_notes = bookingData.notes.internal;\n      }\n    }\n    \n    if (bookingData.assignedStaff) {\n      updateData.assigned_staff_id = bookingData.assignedStaff;\n    }\n    \n    const { data, error } = await supabase\n      .from('bookings')\n      .update(updateData)\n      .eq('id', id)\n      .select()\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return data;\n  },\n  \n  // Cancel a booking\n  cancelBooking: async (id, reason) => {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n    \n    // Get booking to determine who is cancelling\n    const { data: booking, error: bookingError } = await supabase\n      .from('bookings')\n      .select('client_id, provider_id')\n      .eq('id', id)\n      .single();\n      \n    if (bookingError) {\n      throw new Error('Booking not found');\n    }\n    \n    // Determine who is cancelling\n    let cancellationBy;\n    if (booking.client_id === user.id) {\n      cancellationBy = 'client';\n    } else if (booking.provider_id === user.id) {\n      cancellationBy = 'provider';\n    } else if (user.user_metadata?.role === 'admin') {\n      cancellationBy = 'admin';\n    } else {\n      throw new Error('Not authorized to cancel this booking');\n    }\n    \n    // Update booking\n    const { data, error } = await supabase\n      .from('bookings')\n      .update({\n        status: 'cancelled',\n        cancellation_reason: reason || 'No reason provided',\n        cancellation_time: new Date().toISOString(),\n        cancellation_by: cancellationBy\n      })\n      .eq('id', id)\n      .select()\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return data;\n  },\n  \n  // Mark a booking as completed\n  completeBooking: async (id) => {\n    const { data, error } = await supabase\n      .from('bookings')\n      .update({ status: 'completed' })\n      .eq('id', id)\n      .select()\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return data;\n  },\n  \n  // Add a review to a booking\n  addReview: async (bookingId, reviewData) => {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n    \n    // Get booking to verify client and provider\n    const { data: booking, error: bookingError } = await supabase\n      .from('bookings')\n      .select('client_id, provider_id, status')\n      .eq('id', bookingId)\n      .single();\n      \n    if (bookingError) {\n      throw new Error('Booking not found');\n    }\n    \n    // Verify client is adding the review\n    if (booking.client_id !== user.id) {\n      throw new Error('Not authorized to review this booking');\n    }\n    \n    // Verify booking is completed\n    if (booking.status !== 'completed') {\n      throw new Error('Can only review completed bookings');\n    }\n    \n    // Create the review\n    const newReview = {\n      booking_id: bookingId,\n      client_id: user.id,\n      provider_id: booking.provider_id,\n      rating: reviewData.rating,\n      comment: reviewData.comment || ''\n    };\n    \n    const { data, error } = await supabase\n      .from('reviews')\n      .insert(newReview)\n      .select()\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return data;\n  }\n};\n\n// Payment methods\nexport const payments = {\n  // Create a payment intent\n  createPaymentIntent: async (bookingId) => {\n    // For now, we'll just make an API call to the existing endpoint\n    // This would ideally be replaced with a direct Supabase Edge Function call\n    \n    const { data: { session } } = await supabase.auth.getSession();\n    \n    if (!session) {\n      throw new Error('Not authenticated');\n    }\n    \n    const response = await fetch(`${process.env.REACT_APP_API_URL || 'http://localhost:5000/api'}/payments/create-intent`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${session.access_token}`\n      },\n      body: JSON.stringify({ bookingId })\n    });\n    \n    const data = await response.json();\n    \n    if (!response.ok) {\n      throw new Error(data.error || 'Failed to create payment intent');\n    }\n    \n    return data;\n  }\n};\n\n// Widget integration methods\nexport const widget = {\n  // Generate an API key\n  generateApiKey: async (keyName) => {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n    \n    // Call the RPC function to generate an API key\n    const { data, error } = await supabase.rpc('generate_api_key', {\n      business_id: user.id,\n      key_name: keyName || 'Widget API Key'\n    });\n    \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return data;\n  },\n  \n  // Get embed code\n  getEmbedCode: async (options = {}) => {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n    \n    // Get API keys\n    const { data: apiKeys, error: keysError } = await supabase\n      .from('api_keys')\n      .select('key_value')\n      .eq('business_id', user.id)\n      .limit(1);\n      \n    if (keysError || !apiKeys || apiKeys.length === 0) {\n      throw new Error('API key not found. Generate one first.');\n    }\n    \n    // Get widget settings\n    const { data: widgetSettings, error: settingsError } = await supabase\n      .from('widget_settings')\n      .select('*')\n      .eq('business_id', user.id)\n      .maybeSingle();\n      \n    if (settingsError && settingsError.code !== 'PGRST116') {\n      console.error('Error fetching widget settings:', settingsError);\n    }\n    \n    // Get user data\n    const { data: userData, error: userError } = await supabase\n      .from('users')\n      .select('business_name, name')\n      .eq('id', user.id)\n      .single();\n      \n    if (userError) {\n      console.error('Error fetching user data:', userError);\n    }\n    \n    // Merge options with settings\n    const settings = {\n      ...(widgetSettings || {}),\n      ...options\n    };\n    \n    // Generate the embed code\n    const serverUrl = process.env.REACT_APP_API_URL || 'http://localhost:5000';\n    const businessName = userData?.business_name || userData?.name || 'Our Business';\n    \n    const embedCode = `\n<div id=\"dog-services-widget\"></div>\n<script>\n  (function() {\n    const script = document.createElement('script');\n    script.src = \"${serverUrl}/widget.js\";\n    script.async = true;\n    script.onload = function() {\n      DogServicesWidget.init({\n        apiKey: \"${apiKeys[0].key_value}\",\n        containerId: \"dog-services-widget\",\n        businessName: \"${businessName}\",\n        primaryColor: \"${settings.primary_color || '#4F46E5'}\",\n        secondaryColor: \"${settings.secondary_color || '#10B981'}\",\n        fontFamily: \"${settings.font_family || 'sans-serif'}\",\n        borderRadius: \"${settings.border_radius || '8px'}\",\n        layout: \"${settings.layout || 'default'}\"\n      });\n    };\n    document.head.appendChild(script);\n  })();\n</script>\n`;\n    \n    return embedCode;\n  },\n  \n  // Get services for widget\n  getWidgetServices: async (apiKey) => {\n    // Validate API key\n    const { data: keyData, error: keyError } = await supabase\n      .from('api_keys')\n      .select('business_id')\n      .eq('key_value', apiKey)\n      .single();\n      \n    if (keyError) {\n      throw new Error('Invalid API key');\n    }\n    \n    // Get business services\n    const { data, error } = await supabase\n      .from('services')\n      .select('*')\n      .eq('provider_id', keyData.business_id);\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return data;\n  }\n};\n\n// The primary export is used for compatibility with the existing API service\nexport default {\n  auth,\n  users,\n  pets,\n  services,\n  bookings,\n  payments,\n  widget\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}