{"ast":null,"code":"import supabase from './supabaseClient';\n\n// Auth methods\nexport const auth = {\n  // Register a new user\n  register: async userData => {\n    var _data$user;\n    const {\n      email,\n      password,\n      name,\n      role,\n      businessName,\n      businessCategory,\n      phone,\n      address\n    } = userData;\n\n    // Create metadata\n    const metadata = {\n      name,\n      role: role || 'client',\n      phone,\n      businessName,\n      businessCategory\n    };\n    const {\n      data,\n      error\n    } = await supabase.auth.signUp({\n      email,\n      password,\n      options: {\n        data: metadata\n      }\n    });\n    if (error) {\n      throw new Error(error.message);\n    }\n\n    // Additional profile data\n    if (data !== null && data !== void 0 && (_data$user = data.user) !== null && _data$user !== void 0 && _data$user.id) {\n      if (role === 'business' && businessName) {\n        const {\n          error: profileError\n        } = await supabase.from('users').update({\n          business_name: businessName,\n          business_category: businessCategory\n        }).eq('id', data.user.id);\n        if (profileError) {\n          console.error('Error updating business profile:', profileError);\n        }\n      }\n      if (address) {\n        const {\n          error: addressError\n        } = await supabase.from('users').update({\n          street: address.street,\n          city: address.city,\n          state: address.state,\n          zip_code: address.zipCode,\n          country: address.country\n        }).eq('id', data.user.id);\n        if (addressError) {\n          console.error('Error updating address:', addressError);\n        }\n      }\n    }\n    return {\n      user: {\n        id: data.user.id,\n        name,\n        email: data.user.email,\n        role: role || 'client'\n      },\n      session: data.session\n    };\n  },\n  // Sign in with email and password\n  login: async credentials => {\n    const {\n      email,\n      password\n    } = credentials;\n\n    // Validate required fields\n    if (!email) {\n      console.error('Login error: Missing email');\n      throw new Error('Email is required');\n    }\n    if (!password) {\n      console.error('Login error: Missing password');\n      throw new Error('Password is required');\n    }\n    console.log('Attempting to sign in with email:', email);\n    try {\n      var _data$user$user_metad, _data$user$user_metad2;\n      const {\n        data,\n        error\n      } = await supabase.auth.signInWithPassword({\n        email,\n        password\n      });\n      if (error) {\n        console.error('Supabase auth error:', error);\n        throw new Error(error.message);\n      }\n      if (!data || !data.user) {\n        console.error('No user data returned from auth');\n        throw new Error('Authentication failed');\n      }\n\n      // Get user profile data\n      const {\n        data: userData,\n        error: profileError\n      } = await supabase.from('users').select('*').eq('id', data.user.id).single();\n      if (profileError) {\n        console.error('Error fetching user profile:', profileError);\n      }\n      return {\n        user: {\n          id: data.user.id,\n          name: (userData === null || userData === void 0 ? void 0 : userData.name) || ((_data$user$user_metad = data.user.user_metadata) === null || _data$user$user_metad === void 0 ? void 0 : _data$user$user_metad.name),\n          email: data.user.email,\n          role: (userData === null || userData === void 0 ? void 0 : userData.role) || ((_data$user$user_metad2 = data.user.user_metadata) === null || _data$user$user_metad2 === void 0 ? void 0 : _data$user$user_metad2.role) || 'client',\n          isVerified: data.user.email_confirmed_at ? true : false,\n          avatar: userData === null || userData === void 0 ? void 0 : userData.avatar_url,\n          businessName: userData === null || userData === void 0 ? void 0 : userData.business_name\n        },\n        session: data.session\n      };\n    } catch (err) {\n      console.error('Login error in supabaseService:', err);\n      throw err;\n    }\n  },\n  // Sign out\n  logout: async () => {\n    const {\n      error\n    } = await supabase.auth.signOut();\n    if (error) {\n      throw new Error(error.message);\n    }\n    return true;\n  },\n  // Get the current session\n  getSession: async () => {\n    const {\n      data,\n      error\n    } = await supabase.auth.getSession();\n    if (error) {\n      throw new Error(error.message);\n    }\n    return data.session;\n  },\n  // Reset password\n  resetPassword: async email => {\n    const {\n      error\n    } = await supabase.auth.resetPasswordForEmail(email, {\n      redirectTo: `${window.location.origin}/reset-password`\n    });\n    if (error) {\n      throw new Error(error.message);\n    }\n    return true;\n  },\n  // Update password\n  updatePassword: async newPassword => {\n    const {\n      error\n    } = await supabase.auth.updateUser({\n      password: newPassword\n    });\n    if (error) {\n      throw new Error(error.message);\n    }\n    return true;\n  }\n};\n\n// User methods\nexport const users = {\n  // Get current user profile\n  getCurrentUser: async () => {\n    var _user$user_metadata, _user$user_metadata2;\n    // First get the auth user\n    const {\n      data: {\n        user\n      }\n    } = await supabase.auth.getUser();\n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n\n    // Then get the profile data\n    const {\n      data,\n      error\n    } = await supabase.from('users').select('*').eq('id', user.id).single();\n    if (error) {\n      throw new Error(error.message);\n    }\n    return {\n      id: user.id,\n      name: data.name || ((_user$user_metadata = user.user_metadata) === null || _user$user_metadata === void 0 ? void 0 : _user$user_metadata.name),\n      email: user.email,\n      role: data.role || ((_user$user_metadata2 = user.user_metadata) === null || _user$user_metadata2 === void 0 ? void 0 : _user$user_metadata2.role) || 'client',\n      phone: data.phone,\n      avatar: data.avatar_url,\n      address: {\n        street: data.street,\n        city: data.city,\n        state: data.state,\n        zipCode: data.zip_code,\n        country: data.country\n      },\n      businessName: data.business_name,\n      businessCategory: data.business_category,\n      businessDescription: data.business_description,\n      website: data.website\n    };\n  },\n  // Update user profile\n  updateProfile: async profileData => {\n    var _profileData$address, _profileData$address2, _profileData$address3, _profileData$address4, _profileData$address5;\n    const {\n      data: {\n        user\n      }\n    } = await supabase.auth.getUser();\n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n\n    // Format data for Supabase\n    const updateData = {\n      name: profileData.name,\n      phone: profileData.phone,\n      street: (_profileData$address = profileData.address) === null || _profileData$address === void 0 ? void 0 : _profileData$address.street,\n      city: (_profileData$address2 = profileData.address) === null || _profileData$address2 === void 0 ? void 0 : _profileData$address2.city,\n      state: (_profileData$address3 = profileData.address) === null || _profileData$address3 === void 0 ? void 0 : _profileData$address3.state,\n      zip_code: (_profileData$address4 = profileData.address) === null || _profileData$address4 === void 0 ? void 0 : _profileData$address4.zipCode,\n      country: (_profileData$address5 = profileData.address) === null || _profileData$address5 === void 0 ? void 0 : _profileData$address5.country\n    };\n\n    // Add business fields if needed\n    if (profileData.businessName) {\n      updateData.business_name = profileData.businessName;\n      updateData.business_category = profileData.businessCategory;\n      updateData.business_description = profileData.businessDescription;\n      updateData.website = profileData.website;\n    }\n    const {\n      data,\n      error\n    } = await supabase.from('users').update(updateData).eq('id', user.id).select().single();\n    if (error) {\n      throw new Error(error.message);\n    }\n\n    // Format the response to match the existing API format\n    return {\n      user: {\n        id: user.id,\n        name: data.name,\n        email: user.email,\n        role: data.role,\n        phone: data.phone,\n        avatar: data.avatar_url,\n        address: {\n          street: data.street,\n          city: data.city,\n          state: data.state,\n          zipCode: data.zip_code,\n          country: data.country\n        },\n        businessName: data.business_name,\n        businessCategory: data.business_category,\n        businessDescription: data.business_description,\n        website: data.website\n      }\n    };\n  },\n  // Upload avatar\n  uploadAvatar: async file => {\n    const {\n      data: {\n        user\n      }\n    } = await supabase.auth.getUser();\n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n\n    // Create a unique filename\n    const fileExt = file.name.split('.').pop();\n    const fileName = `${user.id}/${Date.now()}.${fileExt}`;\n    const filePath = `avatars/${fileName}`;\n\n    // Upload to Supabase Storage\n    const {\n      error: uploadError\n    } = await supabase.storage.from('profiles').upload(filePath, file);\n    if (uploadError) {\n      throw new Error(uploadError.message);\n    }\n\n    // Get the public URL\n    const {\n      data: {\n        publicUrl\n      }\n    } = supabase.storage.from('profiles').getPublicUrl(filePath);\n\n    // Update user profile with avatar URL\n    const {\n      error: updateError\n    } = await supabase.from('users').update({\n      avatar_url: publicUrl\n    }).eq('id', user.id);\n    if (updateError) {\n      throw new Error(updateError.message);\n    }\n    return publicUrl;\n  }\n};\n\n// Pet methods\nexport const pets = {\n  // Get all pets for current user\n  getPets: async () => {\n    const {\n      data: {\n        user\n      }\n    } = await supabase.auth.getUser();\n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n    const {\n      data,\n      error\n    } = await supabase.from('pets').select('*').eq('owner_id', user.id);\n    if (error) {\n      throw new Error(error.message);\n    }\n    return data;\n  },\n  // Get a specific pet\n  getPet: async id => {\n    const {\n      data,\n      error\n    } = await supabase.from('pets').select(`\n        *,\n        pet_emergency_contacts(*)\n      `).eq('id', id).single();\n    if (error) {\n      throw new Error(error.message);\n    }\n    return data;\n  },\n  // Create a new pet\n  createPet: async petData => {\n    const {\n      data: {\n        user\n      }\n    } = await supabase.auth.getUser();\n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n\n    // Format data for Supabase\n    const newPet = {\n      owner_id: user.id,\n      name: petData.name,\n      type: petData.type,\n      breed: petData.breed,\n      age: petData.age,\n      gender: petData.gender,\n      special_requirements: petData.specialRequirements\n    };\n    const {\n      data,\n      error\n    } = await supabase.from('pets').insert(newPet).select().single();\n    if (error) {\n      throw new Error(error.message);\n    }\n\n    // If emergency contacts were provided, add them\n    if (petData.emergencyContacts && petData.emergencyContacts.length > 0) {\n      const emergencyContacts = petData.emergencyContacts.map(contact => ({\n        pet_id: data.id,\n        name: contact.name,\n        phone: contact.phone,\n        email: contact.email,\n        relationship: contact.relationship\n      }));\n      const {\n        error: contactsError\n      } = await supabase.from('pet_emergency_contacts').insert(emergencyContacts);\n      if (contactsError) {\n        console.error('Error adding emergency contacts:', contactsError);\n      }\n    }\n    return data;\n  },\n  // Update an existing pet\n  updatePet: async (id, petData) => {\n    // Format data for Supabase\n    const updateData = {\n      name: petData.name,\n      type: petData.type,\n      breed: petData.breed,\n      age: petData.age,\n      gender: petData.gender,\n      special_requirements: petData.specialRequirements\n    };\n    const {\n      data,\n      error\n    } = await supabase.from('pets').update(updateData).eq('id', id).select().single();\n    if (error) {\n      throw new Error(error.message);\n    }\n\n    // If emergency contacts were provided, update them\n    if (petData.emergencyContacts && petData.emergencyContacts.length > 0) {\n      // First delete existing contacts\n      const {\n        error: deleteError\n      } = await supabase.from('pet_emergency_contacts').delete().eq('pet_id', id);\n      if (deleteError) {\n        console.error('Error deleting emergency contacts:', deleteError);\n      }\n\n      // Then add new ones\n      const emergencyContacts = petData.emergencyContacts.map(contact => ({\n        pet_id: id,\n        name: contact.name,\n        phone: contact.phone,\n        email: contact.email,\n        relationship: contact.relationship\n      }));\n      const {\n        error: contactsError\n      } = await supabase.from('pet_emergency_contacts').insert(emergencyContacts);\n      if (contactsError) {\n        console.error('Error adding emergency contacts:', contactsError);\n      }\n    }\n    return data;\n  },\n  // Delete a pet\n  deletePet: async id => {\n    const {\n      error\n    } = await supabase.from('pets').delete().eq('id', id);\n    if (error) {\n      throw new Error(error.message);\n    }\n    return true;\n  },\n  // Upload pet photo\n  uploadPetPhoto: async (id, file) => {\n    // Create a unique filename\n    const fileExt = file.name.split('.').pop();\n    const fileName = `${id}/${Date.now()}.${fileExt}`;\n    const filePath = `pets/${fileName}`;\n\n    // Upload to Supabase Storage\n    const {\n      error: uploadError\n    } = await supabase.storage.from('pet-photos').upload(filePath, file);\n    if (uploadError) {\n      throw new Error(uploadError.message);\n    }\n\n    // Get the public URL\n    const {\n      data: {\n        publicUrl\n      }\n    } = supabase.storage.from('pet-photos').getPublicUrl(filePath);\n\n    // Update pet with photo URL\n    const {\n      error: updateError\n    } = await supabase.from('pets').update({\n      photo_url: publicUrl\n    }).eq('id', id);\n    if (updateError) {\n      throw new Error(updateError.message);\n    }\n    return publicUrl;\n  }\n};\n\n// Service methods\nexport const services = {\n  // Get all services with optional filters\n  getServices: async params => {\n    let query = supabase.from('services').select('*');\n\n    // Apply filters if provided\n    if (params) {\n      if (params.providerId) {\n        query = query.eq('provider_id', params.providerId);\n      }\n      if (params.category) {\n        query = query.eq('category', params.category);\n      }\n    }\n    const {\n      data,\n      error\n    } = await query;\n    if (error) {\n      throw new Error(error.message);\n    }\n    return data;\n  },\n  // Get a specific service with all related data\n  getService: async id => {\n    const {\n      data: service,\n      error: serviceError\n    } = await supabase.from('services').select('*').eq('id', id).single();\n    if (serviceError) {\n      throw new Error(serviceError.message);\n    }\n\n    // Get availability\n    const {\n      data: availability,\n      error: availabilityError\n    } = await supabase.from('service_availability').select('*').eq('service_id', id);\n    if (availabilityError) {\n      console.error('Error fetching availability:', availabilityError);\n    }\n\n    // Get custom form schema if exists\n    const {\n      data: customForm,\n      error: formError\n    } = await supabase.from('service_custom_forms').select('*').eq('service_id', id).maybeSingle();\n    if (formError && formError.code !== 'PGRST116') {\n      console.error('Error fetching custom form:', formError);\n    }\n    return {\n      ...service,\n      availability: availability || [],\n      customForm: customForm ? customForm.form_schema : null\n    };\n  },\n  // Create a new service\n  createService: async serviceData => {\n    const {\n      data: {\n        user\n      }\n    } = await supabase.auth.getUser();\n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n\n    // Format data for Supabase\n    const newService = {\n      provider_id: user.id,\n      title: serviceData.title,\n      description: serviceData.description,\n      category: serviceData.category,\n      price_amount: serviceData.price.amount,\n      price_currency: serviceData.price.currency || 'USD',\n      duration: serviceData.duration,\n      location_options: serviceData.locationOptions,\n      capacity: serviceData.capacity || 1,\n      buffer_time: serviceData.bufferTime || 0\n    };\n    const {\n      data,\n      error\n    } = await supabase.from('services').insert(newService).select().single();\n    if (error) {\n      throw new Error(error.message);\n    }\n\n    // Add availability if provided\n    if (serviceData.availability && serviceData.availability.length > 0) {\n      const availability = serviceData.availability.map(slot => ({\n        service_id: data.id,\n        day_of_week: slot.dayOfWeek,\n        specific_date: slot.specificDate,\n        start_time: slot.startTime,\n        end_time: slot.endTime,\n        is_available: slot.isAvailable !== false\n      }));\n      const {\n        error: availabilityError\n      } = await supabase.from('service_availability').insert(availability);\n      if (availabilityError) {\n        console.error('Error adding availability:', availabilityError);\n      }\n    }\n\n    // Add custom form if provided\n    if (serviceData.customForm) {\n      const {\n        error: formError\n      } = await supabase.from('service_custom_forms').insert({\n        service_id: data.id,\n        form_schema: serviceData.customForm\n      });\n      if (formError) {\n        console.error('Error adding custom form:', formError);\n      }\n    }\n    return data;\n  },\n  // Update an existing service\n  updateService: async (id, serviceData) => {\n    // Format data for Supabase\n    const updateData = {\n      title: serviceData.title,\n      description: serviceData.description,\n      category: serviceData.category,\n      price_amount: serviceData.price.amount,\n      price_currency: serviceData.price.currency || 'USD',\n      duration: serviceData.duration,\n      location_options: serviceData.locationOptions,\n      capacity: serviceData.capacity || 1,\n      buffer_time: serviceData.bufferTime || 0\n    };\n    const {\n      data,\n      error\n    } = await supabase.from('services').update(updateData).eq('id', id).select().single();\n    if (error) {\n      throw new Error(error.message);\n    }\n\n    // Update availability if provided\n    if (serviceData.availability && serviceData.availability.length > 0) {\n      // First delete existing availability\n      const {\n        error: deleteError\n      } = await supabase.from('service_availability').delete().eq('service_id', id);\n      if (deleteError) {\n        console.error('Error deleting availability:', deleteError);\n      }\n\n      // Then add new availability\n      const availability = serviceData.availability.map(slot => ({\n        service_id: id,\n        day_of_week: slot.dayOfWeek,\n        specific_date: slot.specificDate,\n        start_time: slot.startTime,\n        end_time: slot.endTime,\n        is_available: slot.isAvailable !== false\n      }));\n      const {\n        error: availabilityError\n      } = await supabase.from('service_availability').insert(availability);\n      if (availabilityError) {\n        console.error('Error adding availability:', availabilityError);\n      }\n    }\n\n    // Update custom form if provided\n    if (serviceData.customForm) {\n      // Check if form already exists\n      const {\n        data: existingForm,\n        error: checkError\n      } = await supabase.from('service_custom_forms').select('id').eq('service_id', id).maybeSingle();\n      if (checkError && checkError.code !== 'PGRST116') {\n        console.error('Error checking custom form:', checkError);\n      }\n      if (existingForm) {\n        // Update existing form\n        const {\n          error: updateError\n        } = await supabase.from('service_custom_forms').update({\n          form_schema: serviceData.customForm\n        }).eq('id', existingForm.id);\n        if (updateError) {\n          console.error('Error updating custom form:', updateError);\n        }\n      } else {\n        // Insert new form\n        const {\n          error: insertError\n        } = await supabase.from('service_custom_forms').insert({\n          service_id: id,\n          form_schema: serviceData.customForm\n        });\n        if (insertError) {\n          console.error('Error adding custom form:', insertError);\n        }\n      }\n    }\n    return data;\n  },\n  // Delete a service\n  deleteService: async id => {\n    const {\n      error\n    } = await supabase.from('services').delete().eq('id', id);\n    if (error) {\n      throw new Error(error.message);\n    }\n    return true;\n  }\n};\n\n// Booking methods\nexport const bookings = {\n  // Get all bookings with filters\n  getBookings: async params => {\n    var _user$user_metadata3, _user$user_metadata4;\n    const {\n      data: {\n        user\n      }\n    } = await supabase.auth.getUser();\n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n    let query = supabase.from('bookings').select(`\n        *,\n        services(title, description, price_amount, price_currency),\n        pets(name, type, breed)\n      `);\n\n    // Apply filters based on user role and params\n    if (((_user$user_metadata3 = user.user_metadata) === null || _user$user_metadata3 === void 0 ? void 0 : _user$user_metadata3.role) === 'client') {\n      query = query.eq('client_id', user.id);\n    } else if (((_user$user_metadata4 = user.user_metadata) === null || _user$user_metadata4 === void 0 ? void 0 : _user$user_metadata4.role) === 'business') {\n      query = query.eq('provider_id', user.id);\n    }\n    if (params) {\n      if (params.status) {\n        query = query.eq('status', params.status);\n      }\n      if (params.startDate && params.endDate) {\n        query = query.gte('start_time', params.startDate).lte('start_time', params.endDate);\n      }\n    }\n\n    // Order by start time, newest first\n    query = query.order('start_time', {\n      ascending: false\n    });\n    const {\n      data,\n      error\n    } = await query;\n    if (error) {\n      throw new Error(error.message);\n    }\n    return data;\n  },\n  // Get a specific booking\n  getBooking: async id => {\n    const {\n      data,\n      error\n    } = await supabase.from('bookings').select(`\n        *,\n        services(*),\n        reviews(*)\n      `).eq('id', id).single();\n    if (error) {\n      throw new Error(error.message);\n    }\n    return data;\n  },\n  // Create a new booking\n  createBooking: async bookingData => {\n    var _bookingData$notes, _bookingData$notes2, _bookingData$notes3;\n    const {\n      data: {\n        user\n      }\n    } = await supabase.auth.getUser();\n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n\n    // Get service to verify provider and price\n    const {\n      data: service,\n      error: serviceError\n    } = await supabase.from('services').select('provider_id, price_amount, price_currency').eq('id', bookingData.serviceId).single();\n    if (serviceError) {\n      throw new Error('Service not found');\n    }\n\n    // Format booking data for Supabase\n    const newBooking = {\n      service_id: bookingData.serviceId,\n      provider_id: bookingData.providerId || service.provider_id,\n      client_id: user.id,\n      pet_id: bookingData.petId,\n      start_time: new Date(bookingData.startTime).toISOString(),\n      end_time: new Date(bookingData.endTime).toISOString(),\n      location: bookingData.location,\n      total_price_amount: service.price_amount,\n      total_price_currency: service.price_currency || 'USD',\n      client_notes: ((_bookingData$notes = bookingData.notes) === null || _bookingData$notes === void 0 ? void 0 : _bookingData$notes.client) || null,\n      provider_notes: ((_bookingData$notes2 = bookingData.notes) === null || _bookingData$notes2 === void 0 ? void 0 : _bookingData$notes2.provider) || null,\n      internal_notes: ((_bookingData$notes3 = bookingData.notes) === null || _bookingData$notes3 === void 0 ? void 0 : _bookingData$notes3.internal) || null,\n      custom_form_data: bookingData.customFormData || null,\n      status: 'pending'\n    };\n    const {\n      data,\n      error\n    } = await supabase.from('bookings').insert(newBooking).select().single();\n    if (error) {\n      throw new Error(error.message);\n    }\n    return data;\n  },\n  // Update an existing booking\n  updateBooking: async (id, bookingData) => {\n    // Format data for Supabase\n    const updateData = {};\n    if (bookingData.startTime) {\n      updateData.start_time = new Date(bookingData.startTime).toISOString();\n    }\n    if (bookingData.endTime) {\n      updateData.end_time = new Date(bookingData.endTime).toISOString();\n    }\n    if (bookingData.status) {\n      updateData.status = bookingData.status;\n    }\n    if (bookingData.notes) {\n      if (bookingData.notes.client !== undefined) {\n        updateData.client_notes = bookingData.notes.client;\n      }\n      if (bookingData.notes.provider !== undefined) {\n        updateData.provider_notes = bookingData.notes.provider;\n      }\n      if (bookingData.notes.internal !== undefined) {\n        updateData.internal_notes = bookingData.notes.internal;\n      }\n    }\n    if (bookingData.assignedStaff) {\n      updateData.assigned_staff_id = bookingData.assignedStaff;\n    }\n    const {\n      data,\n      error\n    } = await supabase.from('bookings').update(updateData).eq('id', id).select().single();\n    if (error) {\n      throw new Error(error.message);\n    }\n    return data;\n  },\n  // Cancel a booking\n  cancelBooking: async (id, reason) => {\n    var _user$user_metadata5;\n    const {\n      data: {\n        user\n      }\n    } = await supabase.auth.getUser();\n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n\n    // Get booking to determine who is cancelling\n    const {\n      data: booking,\n      error: bookingError\n    } = await supabase.from('bookings').select('client_id, provider_id').eq('id', id).single();\n    if (bookingError) {\n      throw new Error('Booking not found');\n    }\n\n    // Determine who is cancelling\n    let cancellationBy;\n    if (booking.client_id === user.id) {\n      cancellationBy = 'client';\n    } else if (booking.provider_id === user.id) {\n      cancellationBy = 'provider';\n    } else if (((_user$user_metadata5 = user.user_metadata) === null || _user$user_metadata5 === void 0 ? void 0 : _user$user_metadata5.role) === 'admin') {\n      cancellationBy = 'admin';\n    } else {\n      throw new Error('Not authorized to cancel this booking');\n    }\n\n    // Update booking\n    const {\n      data,\n      error\n    } = await supabase.from('bookings').update({\n      status: 'cancelled',\n      cancellation_reason: reason || 'No reason provided',\n      cancellation_time: new Date().toISOString(),\n      cancellation_by: cancellationBy\n    }).eq('id', id).select().single();\n    if (error) {\n      throw new Error(error.message);\n    }\n    return data;\n  },\n  // Mark a booking as completed\n  completeBooking: async id => {\n    const {\n      data,\n      error\n    } = await supabase.from('bookings').update({\n      status: 'completed'\n    }).eq('id', id).select().single();\n    if (error) {\n      throw new Error(error.message);\n    }\n    return data;\n  },\n  // Add a review to a booking\n  addReview: async (bookingId, reviewData) => {\n    const {\n      data: {\n        user\n      }\n    } = await supabase.auth.getUser();\n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n\n    // Get booking to verify client and provider\n    const {\n      data: booking,\n      error: bookingError\n    } = await supabase.from('bookings').select('client_id, provider_id, status').eq('id', bookingId).single();\n    if (bookingError) {\n      throw new Error('Booking not found');\n    }\n\n    // Verify client is adding the review\n    if (booking.client_id !== user.id) {\n      throw new Error('Not authorized to review this booking');\n    }\n\n    // Verify booking is completed\n    if (booking.status !== 'completed') {\n      throw new Error('Can only review completed bookings');\n    }\n\n    // Create the review\n    const newReview = {\n      booking_id: bookingId,\n      client_id: user.id,\n      provider_id: booking.provider_id,\n      rating: reviewData.rating,\n      comment: reviewData.comment || ''\n    };\n    const {\n      data,\n      error\n    } = await supabase.from('reviews').insert(newReview).select().single();\n    if (error) {\n      throw new Error(error.message);\n    }\n    return data;\n  }\n};\n\n// Payment methods\nexport const payments = {\n  // Create a payment intent\n  createPaymentIntent: async bookingId => {\n    // For now, we'll just make an API call to the existing endpoint\n    // This would ideally be replaced with a direct Supabase Edge Function call\n\n    const {\n      data: {\n        session\n      }\n    } = await supabase.auth.getSession();\n    if (!session) {\n      throw new Error('Not authenticated');\n    }\n    const response = await fetch(`${process.env.REACT_APP_API_URL || 'http://localhost:5000/api'}/payments/create-intent`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${session.access_token}`\n      },\n      body: JSON.stringify({\n        bookingId\n      })\n    });\n    const data = await response.json();\n    if (!response.ok) {\n      throw new Error(data.error || 'Failed to create payment intent');\n    }\n    return data;\n  }\n};\n\n// The primary export is used for compatibility with the existing API service\nexport default {\n  auth,\n  users,\n  pets,\n  services,\n  bookings,\n  payments,\n  widget\n};","map":{"version":3,"names":["supabase","auth","register","userData","_data$user","email","password","name","role","businessName","businessCategory","phone","address","metadata","data","error","signUp","options","Error","message","user","id","profileError","from","update","business_name","business_category","eq","console","addressError","street","city","state","zip_code","zipCode","country","session","login","credentials","log","_data$user$user_metad","_data$user$user_metad2","signInWithPassword","select","single","user_metadata","isVerified","email_confirmed_at","avatar","avatar_url","err","logout","signOut","getSession","resetPassword","resetPasswordForEmail","redirectTo","window","location","origin","updatePassword","newPassword","updateUser","users","getCurrentUser","_user$user_metadata","_user$user_metadata2","getUser","businessDescription","business_description","website","updateProfile","profileData","_profileData$address","_profileData$address2","_profileData$address3","_profileData$address4","_profileData$address5","updateData","uploadAvatar","file","fileExt","split","pop","fileName","Date","now","filePath","uploadError","storage","upload","publicUrl","getPublicUrl","updateError","pets","getPets","getPet","createPet","petData","newPet","owner_id","type","breed","age","gender","special_requirements","specialRequirements","insert","emergencyContacts","length","map","contact","pet_id","relationship","contactsError","updatePet","deleteError","delete","deletePet","uploadPetPhoto","photo_url","services","getServices","params","query","providerId","category","getService","service","serviceError","availability","availabilityError","customForm","formError","maybeSingle","code","form_schema","createService","serviceData","newService","provider_id","title","description","price_amount","price","amount","price_currency","currency","duration","location_options","locationOptions","capacity","buffer_time","bufferTime","slot","service_id","day_of_week","dayOfWeek","specific_date","specificDate","start_time","startTime","end_time","endTime","is_available","isAvailable","updateService","existingForm","checkError","insertError","deleteService","bookings","getBookings","_user$user_metadata3","_user$user_metadata4","status","startDate","endDate","gte","lte","order","ascending","getBooking","createBooking","bookingData","_bookingData$notes","_bookingData$notes2","_bookingData$notes3","serviceId","newBooking","client_id","petId","toISOString","total_price_amount","total_price_currency","client_notes","notes","client","provider_notes","provider","internal_notes","internal","custom_form_data","customFormData","updateBooking","undefined","assignedStaff","assigned_staff_id","cancelBooking","reason","_user$user_metadata5","booking","bookingError","cancellationBy","cancellation_reason","cancellation_time","cancellation_by","completeBooking","addReview","bookingId","reviewData","newReview","booking_id","rating","comment","payments","createPaymentIntent","response","fetch","process","env","REACT_APP_API_URL","method","headers","access_token","body","JSON","stringify","json","ok","widget"],"sources":["/home/toebot/dog-services-saas/frontend/src/services/supabaseService.js"],"sourcesContent":["import supabase from './supabaseClient';\n\n// Auth methods\nexport const auth = {\n  // Register a new user\n  register: async (userData) => {\n    const { email, password, name, role, businessName, businessCategory, phone, address } = userData;\n    \n    // Create metadata\n    const metadata = {\n      name,\n      role: role || 'client',\n      phone,\n      businessName,\n      businessCategory\n    };\n    \n    const { data, error } = await supabase.auth.signUp({\n      email,\n      password,\n      options: {\n        data: metadata\n      }\n    });\n    \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    // Additional profile data\n    if (data?.user?.id) {\n      if (role === 'business' && businessName) {\n        const { error: profileError } = await supabase\n          .from('users')\n          .update({\n            business_name: businessName,\n            business_category: businessCategory\n          })\n          .eq('id', data.user.id);\n          \n        if (profileError) {\n          console.error('Error updating business profile:', profileError);\n        }\n      }\n      \n      if (address) {\n        const { error: addressError } = await supabase\n          .from('users')\n          .update({\n            street: address.street,\n            city: address.city,\n            state: address.state,\n            zip_code: address.zipCode,\n            country: address.country\n          })\n          .eq('id', data.user.id);\n          \n        if (addressError) {\n          console.error('Error updating address:', addressError);\n        }\n      }\n    }\n    \n    return { \n      user: {\n        id: data.user.id,\n        name,\n        email: data.user.email,\n        role: role || 'client',\n      },\n      session: data.session\n    };\n  },\n  \n  // Sign in with email and password\n  login: async (credentials) => {\n    const { email, password } = credentials;\n    \n    // Validate required fields\n    if (!email) {\n      console.error('Login error: Missing email');\n      throw new Error('Email is required');\n    }\n    \n    if (!password) {\n      console.error('Login error: Missing password');\n      throw new Error('Password is required');\n    }\n    \n    console.log('Attempting to sign in with email:', email);\n    \n    try {\n      const { data, error } = await supabase.auth.signInWithPassword({\n        email,\n        password\n      });\n      \n      if (error) {\n        console.error('Supabase auth error:', error);\n        throw new Error(error.message);\n      }\n      \n      if (!data || !data.user) {\n        console.error('No user data returned from auth');\n        throw new Error('Authentication failed');\n      }\n      \n      // Get user profile data\n      const { data: userData, error: profileError } = await supabase\n        .from('users')\n        .select('*')\n        .eq('id', data.user.id)\n        .single();\n        \n      if (profileError) {\n        console.error('Error fetching user profile:', profileError);\n      }\n      \n      return {\n        user: {\n          id: data.user.id,\n          name: userData?.name || data.user.user_metadata?.name,\n          email: data.user.email,\n          role: userData?.role || data.user.user_metadata?.role || 'client',\n          isVerified: data.user.email_confirmed_at ? true : false,\n          avatar: userData?.avatar_url,\n          businessName: userData?.business_name\n        },\n        session: data.session\n      };\n    } catch (err) {\n      console.error('Login error in supabaseService:', err);\n      throw err;\n    }\n  },\n  \n  // Sign out\n  logout: async () => {\n    const { error } = await supabase.auth.signOut();\n    \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return true;\n  },\n  \n  // Get the current session\n  getSession: async () => {\n    const { data, error } = await supabase.auth.getSession();\n    \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return data.session;\n  },\n  \n  // Reset password\n  resetPassword: async (email) => {\n    const { error } = await supabase.auth.resetPasswordForEmail(email, {\n      redirectTo: `${window.location.origin}/reset-password`\n    });\n    \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return true;\n  },\n  \n  // Update password\n  updatePassword: async (newPassword) => {\n    const { error } = await supabase.auth.updateUser({\n      password: newPassword\n    });\n    \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return true;\n  }\n};\n\n// User methods\nexport const users = {\n  // Get current user profile\n  getCurrentUser: async () => {\n    // First get the auth user\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n    \n    // Then get the profile data\n    const { data, error } = await supabase\n      .from('users')\n      .select('*')\n      .eq('id', user.id)\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return {\n      id: user.id,\n      name: data.name || user.user_metadata?.name,\n      email: user.email,\n      role: data.role || user.user_metadata?.role || 'client',\n      phone: data.phone,\n      avatar: data.avatar_url,\n      address: {\n        street: data.street,\n        city: data.city,\n        state: data.state,\n        zipCode: data.zip_code,\n        country: data.country\n      },\n      businessName: data.business_name,\n      businessCategory: data.business_category,\n      businessDescription: data.business_description,\n      website: data.website\n    };\n  },\n  \n  // Update user profile\n  updateProfile: async (profileData) => {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n    \n    // Format data for Supabase\n    const updateData = {\n      name: profileData.name,\n      phone: profileData.phone,\n      street: profileData.address?.street,\n      city: profileData.address?.city,\n      state: profileData.address?.state,\n      zip_code: profileData.address?.zipCode,\n      country: profileData.address?.country\n    };\n    \n    // Add business fields if needed\n    if (profileData.businessName) {\n      updateData.business_name = profileData.businessName;\n      updateData.business_category = profileData.businessCategory;\n      updateData.business_description = profileData.businessDescription;\n      updateData.website = profileData.website;\n    }\n    \n    const { data, error } = await supabase\n      .from('users')\n      .update(updateData)\n      .eq('id', user.id)\n      .select()\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    // Format the response to match the existing API format\n    return {\n      user: {\n        id: user.id,\n        name: data.name,\n        email: user.email,\n        role: data.role,\n        phone: data.phone,\n        avatar: data.avatar_url,\n        address: {\n          street: data.street,\n          city: data.city,\n          state: data.state,\n          zipCode: data.zip_code,\n          country: data.country\n        },\n        businessName: data.business_name,\n        businessCategory: data.business_category,\n        businessDescription: data.business_description,\n        website: data.website\n      }\n    };\n  },\n  \n  // Upload avatar\n  uploadAvatar: async (file) => {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n    \n    // Create a unique filename\n    const fileExt = file.name.split('.').pop();\n    const fileName = `${user.id}/${Date.now()}.${fileExt}`;\n    const filePath = `avatars/${fileName}`;\n    \n    // Upload to Supabase Storage\n    const { error: uploadError } = await supabase.storage\n      .from('profiles')\n      .upload(filePath, file);\n      \n    if (uploadError) {\n      throw new Error(uploadError.message);\n    }\n    \n    // Get the public URL\n    const { data: { publicUrl } } = supabase.storage\n      .from('profiles')\n      .getPublicUrl(filePath);\n      \n    // Update user profile with avatar URL\n    const { error: updateError } = await supabase\n      .from('users')\n      .update({ avatar_url: publicUrl })\n      .eq('id', user.id);\n      \n    if (updateError) {\n      throw new Error(updateError.message);\n    }\n    \n    return publicUrl;\n  }\n};\n\n// Pet methods\nexport const pets = {\n  // Get all pets for current user\n  getPets: async () => {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n    \n    const { data, error } = await supabase\n      .from('pets')\n      .select('*')\n      .eq('owner_id', user.id);\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return data;\n  },\n  \n  // Get a specific pet\n  getPet: async (id) => {\n    const { data, error } = await supabase\n      .from('pets')\n      .select(`\n        *,\n        pet_emergency_contacts(*)\n      `)\n      .eq('id', id)\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return data;\n  },\n  \n  // Create a new pet\n  createPet: async (petData) => {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n    \n    // Format data for Supabase\n    const newPet = {\n      owner_id: user.id,\n      name: petData.name,\n      type: petData.type,\n      breed: petData.breed,\n      age: petData.age,\n      gender: petData.gender,\n      special_requirements: petData.specialRequirements\n    };\n    \n    const { data, error } = await supabase\n      .from('pets')\n      .insert(newPet)\n      .select()\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    // If emergency contacts were provided, add them\n    if (petData.emergencyContacts && petData.emergencyContacts.length > 0) {\n      const emergencyContacts = petData.emergencyContacts.map(contact => ({\n        pet_id: data.id,\n        name: contact.name,\n        phone: contact.phone,\n        email: contact.email,\n        relationship: contact.relationship\n      }));\n      \n      const { error: contactsError } = await supabase\n        .from('pet_emergency_contacts')\n        .insert(emergencyContacts);\n        \n      if (contactsError) {\n        console.error('Error adding emergency contacts:', contactsError);\n      }\n    }\n    \n    return data;\n  },\n  \n  // Update an existing pet\n  updatePet: async (id, petData) => {\n    // Format data for Supabase\n    const updateData = {\n      name: petData.name,\n      type: petData.type,\n      breed: petData.breed,\n      age: petData.age,\n      gender: petData.gender,\n      special_requirements: petData.specialRequirements\n    };\n    \n    const { data, error } = await supabase\n      .from('pets')\n      .update(updateData)\n      .eq('id', id)\n      .select()\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    // If emergency contacts were provided, update them\n    if (petData.emergencyContacts && petData.emergencyContacts.length > 0) {\n      // First delete existing contacts\n      const { error: deleteError } = await supabase\n        .from('pet_emergency_contacts')\n        .delete()\n        .eq('pet_id', id);\n        \n      if (deleteError) {\n        console.error('Error deleting emergency contacts:', deleteError);\n      }\n      \n      // Then add new ones\n      const emergencyContacts = petData.emergencyContacts.map(contact => ({\n        pet_id: id,\n        name: contact.name,\n        phone: contact.phone,\n        email: contact.email,\n        relationship: contact.relationship\n      }));\n      \n      const { error: contactsError } = await supabase\n        .from('pet_emergency_contacts')\n        .insert(emergencyContacts);\n        \n      if (contactsError) {\n        console.error('Error adding emergency contacts:', contactsError);\n      }\n    }\n    \n    return data;\n  },\n  \n  // Delete a pet\n  deletePet: async (id) => {\n    const { error } = await supabase\n      .from('pets')\n      .delete()\n      .eq('id', id);\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return true;\n  },\n  \n  // Upload pet photo\n  uploadPetPhoto: async (id, file) => {\n    // Create a unique filename\n    const fileExt = file.name.split('.').pop();\n    const fileName = `${id}/${Date.now()}.${fileExt}`;\n    const filePath = `pets/${fileName}`;\n    \n    // Upload to Supabase Storage\n    const { error: uploadError } = await supabase.storage\n      .from('pet-photos')\n      .upload(filePath, file);\n      \n    if (uploadError) {\n      throw new Error(uploadError.message);\n    }\n    \n    // Get the public URL\n    const { data: { publicUrl } } = supabase.storage\n      .from('pet-photos')\n      .getPublicUrl(filePath);\n      \n    // Update pet with photo URL\n    const { error: updateError } = await supabase\n      .from('pets')\n      .update({ photo_url: publicUrl })\n      .eq('id', id);\n      \n    if (updateError) {\n      throw new Error(updateError.message);\n    }\n    \n    return publicUrl;\n  }\n};\n\n// Service methods\nexport const services = {\n  // Get all services with optional filters\n  getServices: async (params) => {\n    let query = supabase\n      .from('services')\n      .select('*');\n      \n    // Apply filters if provided\n    if (params) {\n      if (params.providerId) {\n        query = query.eq('provider_id', params.providerId);\n      }\n      \n      if (params.category) {\n        query = query.eq('category', params.category);\n      }\n    }\n    \n    const { data, error } = await query;\n    \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return data;\n  },\n  \n  // Get a specific service with all related data\n  getService: async (id) => {\n    const { data: service, error: serviceError } = await supabase\n      .from('services')\n      .select('*')\n      .eq('id', id)\n      .single();\n      \n    if (serviceError) {\n      throw new Error(serviceError.message);\n    }\n    \n    // Get availability\n    const { data: availability, error: availabilityError } = await supabase\n      .from('service_availability')\n      .select('*')\n      .eq('service_id', id);\n      \n    if (availabilityError) {\n      console.error('Error fetching availability:', availabilityError);\n    }\n    \n    // Get custom form schema if exists\n    const { data: customForm, error: formError } = await supabase\n      .from('service_custom_forms')\n      .select('*')\n      .eq('service_id', id)\n      .maybeSingle();\n      \n    if (formError && formError.code !== 'PGRST116') {\n      console.error('Error fetching custom form:', formError);\n    }\n    \n    return {\n      ...service,\n      availability: availability || [],\n      customForm: customForm ? customForm.form_schema : null\n    };\n  },\n  \n  // Create a new service\n  createService: async (serviceData) => {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n    \n    // Format data for Supabase\n    const newService = {\n      provider_id: user.id,\n      title: serviceData.title,\n      description: serviceData.description,\n      category: serviceData.category,\n      price_amount: serviceData.price.amount,\n      price_currency: serviceData.price.currency || 'USD',\n      duration: serviceData.duration,\n      location_options: serviceData.locationOptions,\n      capacity: serviceData.capacity || 1,\n      buffer_time: serviceData.bufferTime || 0\n    };\n    \n    const { data, error } = await supabase\n      .from('services')\n      .insert(newService)\n      .select()\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    // Add availability if provided\n    if (serviceData.availability && serviceData.availability.length > 0) {\n      const availability = serviceData.availability.map(slot => ({\n        service_id: data.id,\n        day_of_week: slot.dayOfWeek,\n        specific_date: slot.specificDate,\n        start_time: slot.startTime,\n        end_time: slot.endTime,\n        is_available: slot.isAvailable !== false\n      }));\n      \n      const { error: availabilityError } = await supabase\n        .from('service_availability')\n        .insert(availability);\n        \n      if (availabilityError) {\n        console.error('Error adding availability:', availabilityError);\n      }\n    }\n    \n    // Add custom form if provided\n    if (serviceData.customForm) {\n      const { error: formError } = await supabase\n        .from('service_custom_forms')\n        .insert({\n          service_id: data.id,\n          form_schema: serviceData.customForm\n        });\n        \n      if (formError) {\n        console.error('Error adding custom form:', formError);\n      }\n    }\n    \n    return data;\n  },\n  \n  // Update an existing service\n  updateService: async (id, serviceData) => {\n    // Format data for Supabase\n    const updateData = {\n      title: serviceData.title,\n      description: serviceData.description,\n      category: serviceData.category,\n      price_amount: serviceData.price.amount,\n      price_currency: serviceData.price.currency || 'USD',\n      duration: serviceData.duration,\n      location_options: serviceData.locationOptions,\n      capacity: serviceData.capacity || 1,\n      buffer_time: serviceData.bufferTime || 0\n    };\n    \n    const { data, error } = await supabase\n      .from('services')\n      .update(updateData)\n      .eq('id', id)\n      .select()\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    // Update availability if provided\n    if (serviceData.availability && serviceData.availability.length > 0) {\n      // First delete existing availability\n      const { error: deleteError } = await supabase\n        .from('service_availability')\n        .delete()\n        .eq('service_id', id);\n        \n      if (deleteError) {\n        console.error('Error deleting availability:', deleteError);\n      }\n      \n      // Then add new availability\n      const availability = serviceData.availability.map(slot => ({\n        service_id: id,\n        day_of_week: slot.dayOfWeek,\n        specific_date: slot.specificDate,\n        start_time: slot.startTime,\n        end_time: slot.endTime,\n        is_available: slot.isAvailable !== false\n      }));\n      \n      const { error: availabilityError } = await supabase\n        .from('service_availability')\n        .insert(availability);\n        \n      if (availabilityError) {\n        console.error('Error adding availability:', availabilityError);\n      }\n    }\n    \n    // Update custom form if provided\n    if (serviceData.customForm) {\n      // Check if form already exists\n      const { data: existingForm, error: checkError } = await supabase\n        .from('service_custom_forms')\n        .select('id')\n        .eq('service_id', id)\n        .maybeSingle();\n        \n      if (checkError && checkError.code !== 'PGRST116') {\n        console.error('Error checking custom form:', checkError);\n      }\n      \n      if (existingForm) {\n        // Update existing form\n        const { error: updateError } = await supabase\n          .from('service_custom_forms')\n          .update({ form_schema: serviceData.customForm })\n          .eq('id', existingForm.id);\n          \n        if (updateError) {\n          console.error('Error updating custom form:', updateError);\n        }\n      } else {\n        // Insert new form\n        const { error: insertError } = await supabase\n          .from('service_custom_forms')\n          .insert({\n            service_id: id,\n            form_schema: serviceData.customForm\n          });\n          \n        if (insertError) {\n          console.error('Error adding custom form:', insertError);\n        }\n      }\n    }\n    \n    return data;\n  },\n  \n  // Delete a service\n  deleteService: async (id) => {\n    const { error } = await supabase\n      .from('services')\n      .delete()\n      .eq('id', id);\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return true;\n  }\n};\n\n// Booking methods\nexport const bookings = {\n  // Get all bookings with filters\n  getBookings: async (params) => {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n    \n    let query = supabase\n      .from('bookings')\n      .select(`\n        *,\n        services(title, description, price_amount, price_currency),\n        pets(name, type, breed)\n      `);\n      \n    // Apply filters based on user role and params\n    if (user.user_metadata?.role === 'client') {\n      query = query.eq('client_id', user.id);\n    } else if (user.user_metadata?.role === 'business') {\n      query = query.eq('provider_id', user.id);\n    }\n    \n    if (params) {\n      if (params.status) {\n        query = query.eq('status', params.status);\n      }\n      \n      if (params.startDate && params.endDate) {\n        query = query\n          .gte('start_time', params.startDate)\n          .lte('start_time', params.endDate);\n      }\n    }\n    \n    // Order by start time, newest first\n    query = query.order('start_time', { ascending: false });\n    \n    const { data, error } = await query;\n    \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return data;\n  },\n  \n  // Get a specific booking\n  getBooking: async (id) => {\n    const { data, error } = await supabase\n      .from('bookings')\n      .select(`\n        *,\n        services(*),\n        reviews(*)\n      `)\n      .eq('id', id)\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return data;\n  },\n  \n  // Create a new booking\n  createBooking: async (bookingData) => {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n    \n    // Get service to verify provider and price\n    const { data: service, error: serviceError } = await supabase\n      .from('services')\n      .select('provider_id, price_amount, price_currency')\n      .eq('id', bookingData.serviceId)\n      .single();\n      \n    if (serviceError) {\n      throw new Error('Service not found');\n    }\n    \n    // Format booking data for Supabase\n    const newBooking = {\n      service_id: bookingData.serviceId,\n      provider_id: bookingData.providerId || service.provider_id,\n      client_id: user.id,\n      pet_id: bookingData.petId,\n      start_time: new Date(bookingData.startTime).toISOString(),\n      end_time: new Date(bookingData.endTime).toISOString(),\n      location: bookingData.location,\n      total_price_amount: service.price_amount,\n      total_price_currency: service.price_currency || 'USD',\n      client_notes: bookingData.notes?.client || null,\n      provider_notes: bookingData.notes?.provider || null,\n      internal_notes: bookingData.notes?.internal || null,\n      custom_form_data: bookingData.customFormData || null,\n      status: 'pending'\n    };\n    \n    const { data, error } = await supabase\n      .from('bookings')\n      .insert(newBooking)\n      .select()\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return data;\n  },\n  \n  // Update an existing booking\n  updateBooking: async (id, bookingData) => {\n    // Format data for Supabase\n    const updateData = {};\n    \n    if (bookingData.startTime) {\n      updateData.start_time = new Date(bookingData.startTime).toISOString();\n    }\n    \n    if (bookingData.endTime) {\n      updateData.end_time = new Date(bookingData.endTime).toISOString();\n    }\n    \n    if (bookingData.status) {\n      updateData.status = bookingData.status;\n    }\n    \n    if (bookingData.notes) {\n      if (bookingData.notes.client !== undefined) {\n        updateData.client_notes = bookingData.notes.client;\n      }\n      \n      if (bookingData.notes.provider !== undefined) {\n        updateData.provider_notes = bookingData.notes.provider;\n      }\n      \n      if (bookingData.notes.internal !== undefined) {\n        updateData.internal_notes = bookingData.notes.internal;\n      }\n    }\n    \n    if (bookingData.assignedStaff) {\n      updateData.assigned_staff_id = bookingData.assignedStaff;\n    }\n    \n    const { data, error } = await supabase\n      .from('bookings')\n      .update(updateData)\n      .eq('id', id)\n      .select()\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return data;\n  },\n  \n  // Cancel a booking\n  cancelBooking: async (id, reason) => {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n    \n    // Get booking to determine who is cancelling\n    const { data: booking, error: bookingError } = await supabase\n      .from('bookings')\n      .select('client_id, provider_id')\n      .eq('id', id)\n      .single();\n      \n    if (bookingError) {\n      throw new Error('Booking not found');\n    }\n    \n    // Determine who is cancelling\n    let cancellationBy;\n    if (booking.client_id === user.id) {\n      cancellationBy = 'client';\n    } else if (booking.provider_id === user.id) {\n      cancellationBy = 'provider';\n    } else if (user.user_metadata?.role === 'admin') {\n      cancellationBy = 'admin';\n    } else {\n      throw new Error('Not authorized to cancel this booking');\n    }\n    \n    // Update booking\n    const { data, error } = await supabase\n      .from('bookings')\n      .update({\n        status: 'cancelled',\n        cancellation_reason: reason || 'No reason provided',\n        cancellation_time: new Date().toISOString(),\n        cancellation_by: cancellationBy\n      })\n      .eq('id', id)\n      .select()\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return data;\n  },\n  \n  // Mark a booking as completed\n  completeBooking: async (id) => {\n    const { data, error } = await supabase\n      .from('bookings')\n      .update({ status: 'completed' })\n      .eq('id', id)\n      .select()\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return data;\n  },\n  \n  // Add a review to a booking\n  addReview: async (bookingId, reviewData) => {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n    \n    // Get booking to verify client and provider\n    const { data: booking, error: bookingError } = await supabase\n      .from('bookings')\n      .select('client_id, provider_id, status')\n      .eq('id', bookingId)\n      .single();\n      \n    if (bookingError) {\n      throw new Error('Booking not found');\n    }\n    \n    // Verify client is adding the review\n    if (booking.client_id !== user.id) {\n      throw new Error('Not authorized to review this booking');\n    }\n    \n    // Verify booking is completed\n    if (booking.status !== 'completed') {\n      throw new Error('Can only review completed bookings');\n    }\n    \n    // Create the review\n    const newReview = {\n      booking_id: bookingId,\n      client_id: user.id,\n      provider_id: booking.provider_id,\n      rating: reviewData.rating,\n      comment: reviewData.comment || ''\n    };\n    \n    const { data, error } = await supabase\n      .from('reviews')\n      .insert(newReview)\n      .select()\n      .single();\n      \n    if (error) {\n      throw new Error(error.message);\n    }\n    \n    return data;\n  }\n};\n\n// Payment methods\nexport const payments = {\n  // Create a payment intent\n  createPaymentIntent: async (bookingId) => {\n    // For now, we'll just make an API call to the existing endpoint\n    // This would ideally be replaced with a direct Supabase Edge Function call\n    \n    const { data: { session } } = await supabase.auth.getSession();\n    \n    if (!session) {\n      throw new Error('Not authenticated');\n    }\n    \n    const response = await fetch(`${process.env.REACT_APP_API_URL || 'http://localhost:5000/api'}/payments/create-intent`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${session.access_token}`\n      },\n      body: JSON.stringify({ bookingId })\n    });\n    \n    const data = await response.json();\n    \n    if (!response.ok) {\n      throw new Error(data.error || 'Failed to create payment intent');\n    }\n    \n    return data;\n  }\n};\n\n\n// The primary export is used for compatibility with the existing API service\nexport default {\n  auth,\n  users,\n  pets,\n  services,\n  bookings,\n  payments,\n  widget\n};"],"mappings":"AAAA,OAAOA,QAAQ,MAAM,kBAAkB;;AAEvC;AACA,OAAO,MAAMC,IAAI,GAAG;EAClB;EACAC,QAAQ,EAAE,MAAOC,QAAQ,IAAK;IAAA,IAAAC,UAAA;IAC5B,MAAM;MAAEC,KAAK;MAAEC,QAAQ;MAAEC,IAAI;MAAEC,IAAI;MAAEC,YAAY;MAAEC,gBAAgB;MAAEC,KAAK;MAAEC;IAAQ,CAAC,GAAGT,QAAQ;;IAEhG;IACA,MAAMU,QAAQ,GAAG;MACfN,IAAI;MACJC,IAAI,EAAEA,IAAI,IAAI,QAAQ;MACtBG,KAAK;MACLF,YAAY;MACZC;IACF,CAAC;IAED,MAAM;MAAEI,IAAI;MAAEC;IAAM,CAAC,GAAG,MAAMf,QAAQ,CAACC,IAAI,CAACe,MAAM,CAAC;MACjDX,KAAK;MACLC,QAAQ;MACRW,OAAO,EAAE;QACPH,IAAI,EAAED;MACR;IACF,CAAC,CAAC;IAEF,IAAIE,KAAK,EAAE;MACT,MAAM,IAAIG,KAAK,CAACH,KAAK,CAACI,OAAO,CAAC;IAChC;;IAEA;IACA,IAAIL,IAAI,aAAJA,IAAI,gBAAAV,UAAA,GAAJU,IAAI,CAAEM,IAAI,cAAAhB,UAAA,eAAVA,UAAA,CAAYiB,EAAE,EAAE;MAClB,IAAIb,IAAI,KAAK,UAAU,IAAIC,YAAY,EAAE;QACvC,MAAM;UAAEM,KAAK,EAAEO;QAAa,CAAC,GAAG,MAAMtB,QAAQ,CAC3CuB,IAAI,CAAC,OAAO,CAAC,CACbC,MAAM,CAAC;UACNC,aAAa,EAAEhB,YAAY;UAC3BiB,iBAAiB,EAAEhB;QACrB,CAAC,CAAC,CACDiB,EAAE,CAAC,IAAI,EAAEb,IAAI,CAACM,IAAI,CAACC,EAAE,CAAC;QAEzB,IAAIC,YAAY,EAAE;UAChBM,OAAO,CAACb,KAAK,CAAC,kCAAkC,EAAEO,YAAY,CAAC;QACjE;MACF;MAEA,IAAIV,OAAO,EAAE;QACX,MAAM;UAAEG,KAAK,EAAEc;QAAa,CAAC,GAAG,MAAM7B,QAAQ,CAC3CuB,IAAI,CAAC,OAAO,CAAC,CACbC,MAAM,CAAC;UACNM,MAAM,EAAElB,OAAO,CAACkB,MAAM;UACtBC,IAAI,EAAEnB,OAAO,CAACmB,IAAI;UAClBC,KAAK,EAAEpB,OAAO,CAACoB,KAAK;UACpBC,QAAQ,EAAErB,OAAO,CAACsB,OAAO;UACzBC,OAAO,EAAEvB,OAAO,CAACuB;QACnB,CAAC,CAAC,CACDR,EAAE,CAAC,IAAI,EAAEb,IAAI,CAACM,IAAI,CAACC,EAAE,CAAC;QAEzB,IAAIQ,YAAY,EAAE;UAChBD,OAAO,CAACb,KAAK,CAAC,yBAAyB,EAAEc,YAAY,CAAC;QACxD;MACF;IACF;IAEA,OAAO;MACLT,IAAI,EAAE;QACJC,EAAE,EAAEP,IAAI,CAACM,IAAI,CAACC,EAAE;QAChBd,IAAI;QACJF,KAAK,EAAES,IAAI,CAACM,IAAI,CAACf,KAAK;QACtBG,IAAI,EAAEA,IAAI,IAAI;MAChB,CAAC;MACD4B,OAAO,EAAEtB,IAAI,CAACsB;IAChB,CAAC;EACH,CAAC;EAED;EACAC,KAAK,EAAE,MAAOC,WAAW,IAAK;IAC5B,MAAM;MAAEjC,KAAK;MAAEC;IAAS,CAAC,GAAGgC,WAAW;;IAEvC;IACA,IAAI,CAACjC,KAAK,EAAE;MACVuB,OAAO,CAACb,KAAK,CAAC,4BAA4B,CAAC;MAC3C,MAAM,IAAIG,KAAK,CAAC,mBAAmB,CAAC;IACtC;IAEA,IAAI,CAACZ,QAAQ,EAAE;MACbsB,OAAO,CAACb,KAAK,CAAC,+BAA+B,CAAC;MAC9C,MAAM,IAAIG,KAAK,CAAC,sBAAsB,CAAC;IACzC;IAEAU,OAAO,CAACW,GAAG,CAAC,mCAAmC,EAAElC,KAAK,CAAC;IAEvD,IAAI;MAAA,IAAAmC,qBAAA,EAAAC,sBAAA;MACF,MAAM;QAAE3B,IAAI;QAAEC;MAAM,CAAC,GAAG,MAAMf,QAAQ,CAACC,IAAI,CAACyC,kBAAkB,CAAC;QAC7DrC,KAAK;QACLC;MACF,CAAC,CAAC;MAEF,IAAIS,KAAK,EAAE;QACTa,OAAO,CAACb,KAAK,CAAC,sBAAsB,EAAEA,KAAK,CAAC;QAC5C,MAAM,IAAIG,KAAK,CAACH,KAAK,CAACI,OAAO,CAAC;MAChC;MAEA,IAAI,CAACL,IAAI,IAAI,CAACA,IAAI,CAACM,IAAI,EAAE;QACvBQ,OAAO,CAACb,KAAK,CAAC,iCAAiC,CAAC;QAChD,MAAM,IAAIG,KAAK,CAAC,uBAAuB,CAAC;MAC1C;;MAEA;MACA,MAAM;QAAEJ,IAAI,EAAEX,QAAQ;QAAEY,KAAK,EAAEO;MAAa,CAAC,GAAG,MAAMtB,QAAQ,CAC3DuB,IAAI,CAAC,OAAO,CAAC,CACboB,MAAM,CAAC,GAAG,CAAC,CACXhB,EAAE,CAAC,IAAI,EAAEb,IAAI,CAACM,IAAI,CAACC,EAAE,CAAC,CACtBuB,MAAM,CAAC,CAAC;MAEX,IAAItB,YAAY,EAAE;QAChBM,OAAO,CAACb,KAAK,CAAC,8BAA8B,EAAEO,YAAY,CAAC;MAC7D;MAEA,OAAO;QACLF,IAAI,EAAE;UACJC,EAAE,EAAEP,IAAI,CAACM,IAAI,CAACC,EAAE;UAChBd,IAAI,EAAE,CAAAJ,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEI,IAAI,OAAAiC,qBAAA,GAAI1B,IAAI,CAACM,IAAI,CAACyB,aAAa,cAAAL,qBAAA,uBAAvBA,qBAAA,CAAyBjC,IAAI;UACrDF,KAAK,EAAES,IAAI,CAACM,IAAI,CAACf,KAAK;UACtBG,IAAI,EAAE,CAAAL,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEK,IAAI,OAAAiC,sBAAA,GAAI3B,IAAI,CAACM,IAAI,CAACyB,aAAa,cAAAJ,sBAAA,uBAAvBA,sBAAA,CAAyBjC,IAAI,KAAI,QAAQ;UACjEsC,UAAU,EAAEhC,IAAI,CAACM,IAAI,CAAC2B,kBAAkB,GAAG,IAAI,GAAG,KAAK;UACvDC,MAAM,EAAE7C,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAE8C,UAAU;UAC5BxC,YAAY,EAAEN,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEsB;QAC1B,CAAC;QACDW,OAAO,EAAEtB,IAAI,CAACsB;MAChB,CAAC;IACH,CAAC,CAAC,OAAOc,GAAG,EAAE;MACZtB,OAAO,CAACb,KAAK,CAAC,iCAAiC,EAAEmC,GAAG,CAAC;MACrD,MAAMA,GAAG;IACX;EACF,CAAC;EAED;EACAC,MAAM,EAAE,MAAAA,CAAA,KAAY;IAClB,MAAM;MAAEpC;IAAM,CAAC,GAAG,MAAMf,QAAQ,CAACC,IAAI,CAACmD,OAAO,CAAC,CAAC;IAE/C,IAAIrC,KAAK,EAAE;MACT,MAAM,IAAIG,KAAK,CAACH,KAAK,CAACI,OAAO,CAAC;IAChC;IAEA,OAAO,IAAI;EACb,CAAC;EAED;EACAkC,UAAU,EAAE,MAAAA,CAAA,KAAY;IACtB,MAAM;MAAEvC,IAAI;MAAEC;IAAM,CAAC,GAAG,MAAMf,QAAQ,CAACC,IAAI,CAACoD,UAAU,CAAC,CAAC;IAExD,IAAItC,KAAK,EAAE;MACT,MAAM,IAAIG,KAAK,CAACH,KAAK,CAACI,OAAO,CAAC;IAChC;IAEA,OAAOL,IAAI,CAACsB,OAAO;EACrB,CAAC;EAED;EACAkB,aAAa,EAAE,MAAOjD,KAAK,IAAK;IAC9B,MAAM;MAAEU;IAAM,CAAC,GAAG,MAAMf,QAAQ,CAACC,IAAI,CAACsD,qBAAqB,CAAClD,KAAK,EAAE;MACjEmD,UAAU,EAAE,GAAGC,MAAM,CAACC,QAAQ,CAACC,MAAM;IACvC,CAAC,CAAC;IAEF,IAAI5C,KAAK,EAAE;MACT,MAAM,IAAIG,KAAK,CAACH,KAAK,CAACI,OAAO,CAAC;IAChC;IAEA,OAAO,IAAI;EACb,CAAC;EAED;EACAyC,cAAc,EAAE,MAAOC,WAAW,IAAK;IACrC,MAAM;MAAE9C;IAAM,CAAC,GAAG,MAAMf,QAAQ,CAACC,IAAI,CAAC6D,UAAU,CAAC;MAC/CxD,QAAQ,EAAEuD;IACZ,CAAC,CAAC;IAEF,IAAI9C,KAAK,EAAE;MACT,MAAM,IAAIG,KAAK,CAACH,KAAK,CAACI,OAAO,CAAC;IAChC;IAEA,OAAO,IAAI;EACb;AACF,CAAC;;AAED;AACA,OAAO,MAAM4C,KAAK,GAAG;EACnB;EACAC,cAAc,EAAE,MAAAA,CAAA,KAAY;IAAA,IAAAC,mBAAA,EAAAC,oBAAA;IAC1B;IACA,MAAM;MAAEpD,IAAI,EAAE;QAAEM;MAAK;IAAE,CAAC,GAAG,MAAMpB,QAAQ,CAACC,IAAI,CAACkE,OAAO,CAAC,CAAC;IAExD,IAAI,CAAC/C,IAAI,EAAE;MACT,MAAM,IAAIF,KAAK,CAAC,mBAAmB,CAAC;IACtC;;IAEA;IACA,MAAM;MAAEJ,IAAI;MAAEC;IAAM,CAAC,GAAG,MAAMf,QAAQ,CACnCuB,IAAI,CAAC,OAAO,CAAC,CACboB,MAAM,CAAC,GAAG,CAAC,CACXhB,EAAE,CAAC,IAAI,EAAEP,IAAI,CAACC,EAAE,CAAC,CACjBuB,MAAM,CAAC,CAAC;IAEX,IAAI7B,KAAK,EAAE;MACT,MAAM,IAAIG,KAAK,CAACH,KAAK,CAACI,OAAO,CAAC;IAChC;IAEA,OAAO;MACLE,EAAE,EAAED,IAAI,CAACC,EAAE;MACXd,IAAI,EAAEO,IAAI,CAACP,IAAI,MAAA0D,mBAAA,GAAI7C,IAAI,CAACyB,aAAa,cAAAoB,mBAAA,uBAAlBA,mBAAA,CAAoB1D,IAAI;MAC3CF,KAAK,EAAEe,IAAI,CAACf,KAAK;MACjBG,IAAI,EAAEM,IAAI,CAACN,IAAI,MAAA0D,oBAAA,GAAI9C,IAAI,CAACyB,aAAa,cAAAqB,oBAAA,uBAAlBA,oBAAA,CAAoB1D,IAAI,KAAI,QAAQ;MACvDG,KAAK,EAAEG,IAAI,CAACH,KAAK;MACjBqC,MAAM,EAAElC,IAAI,CAACmC,UAAU;MACvBrC,OAAO,EAAE;QACPkB,MAAM,EAAEhB,IAAI,CAACgB,MAAM;QACnBC,IAAI,EAAEjB,IAAI,CAACiB,IAAI;QACfC,KAAK,EAAElB,IAAI,CAACkB,KAAK;QACjBE,OAAO,EAAEpB,IAAI,CAACmB,QAAQ;QACtBE,OAAO,EAAErB,IAAI,CAACqB;MAChB,CAAC;MACD1B,YAAY,EAAEK,IAAI,CAACW,aAAa;MAChCf,gBAAgB,EAAEI,IAAI,CAACY,iBAAiB;MACxC0C,mBAAmB,EAAEtD,IAAI,CAACuD,oBAAoB;MAC9CC,OAAO,EAAExD,IAAI,CAACwD;IAChB,CAAC;EACH,CAAC;EAED;EACAC,aAAa,EAAE,MAAOC,WAAW,IAAK;IAAA,IAAAC,oBAAA,EAAAC,qBAAA,EAAAC,qBAAA,EAAAC,qBAAA,EAAAC,qBAAA;IACpC,MAAM;MAAE/D,IAAI,EAAE;QAAEM;MAAK;IAAE,CAAC,GAAG,MAAMpB,QAAQ,CAACC,IAAI,CAACkE,OAAO,CAAC,CAAC;IAExD,IAAI,CAAC/C,IAAI,EAAE;MACT,MAAM,IAAIF,KAAK,CAAC,mBAAmB,CAAC;IACtC;;IAEA;IACA,MAAM4D,UAAU,GAAG;MACjBvE,IAAI,EAAEiE,WAAW,CAACjE,IAAI;MACtBI,KAAK,EAAE6D,WAAW,CAAC7D,KAAK;MACxBmB,MAAM,GAAA2C,oBAAA,GAAED,WAAW,CAAC5D,OAAO,cAAA6D,oBAAA,uBAAnBA,oBAAA,CAAqB3C,MAAM;MACnCC,IAAI,GAAA2C,qBAAA,GAAEF,WAAW,CAAC5D,OAAO,cAAA8D,qBAAA,uBAAnBA,qBAAA,CAAqB3C,IAAI;MAC/BC,KAAK,GAAA2C,qBAAA,GAAEH,WAAW,CAAC5D,OAAO,cAAA+D,qBAAA,uBAAnBA,qBAAA,CAAqB3C,KAAK;MACjCC,QAAQ,GAAA2C,qBAAA,GAAEJ,WAAW,CAAC5D,OAAO,cAAAgE,qBAAA,uBAAnBA,qBAAA,CAAqB1C,OAAO;MACtCC,OAAO,GAAA0C,qBAAA,GAAEL,WAAW,CAAC5D,OAAO,cAAAiE,qBAAA,uBAAnBA,qBAAA,CAAqB1C;IAChC,CAAC;;IAED;IACA,IAAIqC,WAAW,CAAC/D,YAAY,EAAE;MAC5BqE,UAAU,CAACrD,aAAa,GAAG+C,WAAW,CAAC/D,YAAY;MACnDqE,UAAU,CAACpD,iBAAiB,GAAG8C,WAAW,CAAC9D,gBAAgB;MAC3DoE,UAAU,CAACT,oBAAoB,GAAGG,WAAW,CAACJ,mBAAmB;MACjEU,UAAU,CAACR,OAAO,GAAGE,WAAW,CAACF,OAAO;IAC1C;IAEA,MAAM;MAAExD,IAAI;MAAEC;IAAM,CAAC,GAAG,MAAMf,QAAQ,CACnCuB,IAAI,CAAC,OAAO,CAAC,CACbC,MAAM,CAACsD,UAAU,CAAC,CAClBnD,EAAE,CAAC,IAAI,EAAEP,IAAI,CAACC,EAAE,CAAC,CACjBsB,MAAM,CAAC,CAAC,CACRC,MAAM,CAAC,CAAC;IAEX,IAAI7B,KAAK,EAAE;MACT,MAAM,IAAIG,KAAK,CAACH,KAAK,CAACI,OAAO,CAAC;IAChC;;IAEA;IACA,OAAO;MACLC,IAAI,EAAE;QACJC,EAAE,EAAED,IAAI,CAACC,EAAE;QACXd,IAAI,EAAEO,IAAI,CAACP,IAAI;QACfF,KAAK,EAAEe,IAAI,CAACf,KAAK;QACjBG,IAAI,EAAEM,IAAI,CAACN,IAAI;QACfG,KAAK,EAAEG,IAAI,CAACH,KAAK;QACjBqC,MAAM,EAAElC,IAAI,CAACmC,UAAU;QACvBrC,OAAO,EAAE;UACPkB,MAAM,EAAEhB,IAAI,CAACgB,MAAM;UACnBC,IAAI,EAAEjB,IAAI,CAACiB,IAAI;UACfC,KAAK,EAAElB,IAAI,CAACkB,KAAK;UACjBE,OAAO,EAAEpB,IAAI,CAACmB,QAAQ;UACtBE,OAAO,EAAErB,IAAI,CAACqB;QAChB,CAAC;QACD1B,YAAY,EAAEK,IAAI,CAACW,aAAa;QAChCf,gBAAgB,EAAEI,IAAI,CAACY,iBAAiB;QACxC0C,mBAAmB,EAAEtD,IAAI,CAACuD,oBAAoB;QAC9CC,OAAO,EAAExD,IAAI,CAACwD;MAChB;IACF,CAAC;EACH,CAAC;EAED;EACAS,YAAY,EAAE,MAAOC,IAAI,IAAK;IAC5B,MAAM;MAAElE,IAAI,EAAE;QAAEM;MAAK;IAAE,CAAC,GAAG,MAAMpB,QAAQ,CAACC,IAAI,CAACkE,OAAO,CAAC,CAAC;IAExD,IAAI,CAAC/C,IAAI,EAAE;MACT,MAAM,IAAIF,KAAK,CAAC,mBAAmB,CAAC;IACtC;;IAEA;IACA,MAAM+D,OAAO,GAAGD,IAAI,CAACzE,IAAI,CAAC2E,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,CAAC,CAAC;IAC1C,MAAMC,QAAQ,GAAG,GAAGhE,IAAI,CAACC,EAAE,IAAIgE,IAAI,CAACC,GAAG,CAAC,CAAC,IAAIL,OAAO,EAAE;IACtD,MAAMM,QAAQ,GAAG,WAAWH,QAAQ,EAAE;;IAEtC;IACA,MAAM;MAAErE,KAAK,EAAEyE;IAAY,CAAC,GAAG,MAAMxF,QAAQ,CAACyF,OAAO,CAClDlE,IAAI,CAAC,UAAU,CAAC,CAChBmE,MAAM,CAACH,QAAQ,EAAEP,IAAI,CAAC;IAEzB,IAAIQ,WAAW,EAAE;MACf,MAAM,IAAItE,KAAK,CAACsE,WAAW,CAACrE,OAAO,CAAC;IACtC;;IAEA;IACA,MAAM;MAAEL,IAAI,EAAE;QAAE6E;MAAU;IAAE,CAAC,GAAG3F,QAAQ,CAACyF,OAAO,CAC7ClE,IAAI,CAAC,UAAU,CAAC,CAChBqE,YAAY,CAACL,QAAQ,CAAC;;IAEzB;IACA,MAAM;MAAExE,KAAK,EAAE8E;IAAY,CAAC,GAAG,MAAM7F,QAAQ,CAC1CuB,IAAI,CAAC,OAAO,CAAC,CACbC,MAAM,CAAC;MAAEyB,UAAU,EAAE0C;IAAU,CAAC,CAAC,CACjChE,EAAE,CAAC,IAAI,EAAEP,IAAI,CAACC,EAAE,CAAC;IAEpB,IAAIwE,WAAW,EAAE;MACf,MAAM,IAAI3E,KAAK,CAAC2E,WAAW,CAAC1E,OAAO,CAAC;IACtC;IAEA,OAAOwE,SAAS;EAClB;AACF,CAAC;;AAED;AACA,OAAO,MAAMG,IAAI,GAAG;EAClB;EACAC,OAAO,EAAE,MAAAA,CAAA,KAAY;IACnB,MAAM;MAAEjF,IAAI,EAAE;QAAEM;MAAK;IAAE,CAAC,GAAG,MAAMpB,QAAQ,CAACC,IAAI,CAACkE,OAAO,CAAC,CAAC;IAExD,IAAI,CAAC/C,IAAI,EAAE;MACT,MAAM,IAAIF,KAAK,CAAC,mBAAmB,CAAC;IACtC;IAEA,MAAM;MAAEJ,IAAI;MAAEC;IAAM,CAAC,GAAG,MAAMf,QAAQ,CACnCuB,IAAI,CAAC,MAAM,CAAC,CACZoB,MAAM,CAAC,GAAG,CAAC,CACXhB,EAAE,CAAC,UAAU,EAAEP,IAAI,CAACC,EAAE,CAAC;IAE1B,IAAIN,KAAK,EAAE;MACT,MAAM,IAAIG,KAAK,CAACH,KAAK,CAACI,OAAO,CAAC;IAChC;IAEA,OAAOL,IAAI;EACb,CAAC;EAED;EACAkF,MAAM,EAAE,MAAO3E,EAAE,IAAK;IACpB,MAAM;MAAEP,IAAI;MAAEC;IAAM,CAAC,GAAG,MAAMf,QAAQ,CACnCuB,IAAI,CAAC,MAAM,CAAC,CACZoB,MAAM,CAAC;AACd;AACA;AACA,OAAO,CAAC,CACDhB,EAAE,CAAC,IAAI,EAAEN,EAAE,CAAC,CACZuB,MAAM,CAAC,CAAC;IAEX,IAAI7B,KAAK,EAAE;MACT,MAAM,IAAIG,KAAK,CAACH,KAAK,CAACI,OAAO,CAAC;IAChC;IAEA,OAAOL,IAAI;EACb,CAAC;EAED;EACAmF,SAAS,EAAE,MAAOC,OAAO,IAAK;IAC5B,MAAM;MAAEpF,IAAI,EAAE;QAAEM;MAAK;IAAE,CAAC,GAAG,MAAMpB,QAAQ,CAACC,IAAI,CAACkE,OAAO,CAAC,CAAC;IAExD,IAAI,CAAC/C,IAAI,EAAE;MACT,MAAM,IAAIF,KAAK,CAAC,mBAAmB,CAAC;IACtC;;IAEA;IACA,MAAMiF,MAAM,GAAG;MACbC,QAAQ,EAAEhF,IAAI,CAACC,EAAE;MACjBd,IAAI,EAAE2F,OAAO,CAAC3F,IAAI;MAClB8F,IAAI,EAAEH,OAAO,CAACG,IAAI;MAClBC,KAAK,EAAEJ,OAAO,CAACI,KAAK;MACpBC,GAAG,EAAEL,OAAO,CAACK,GAAG;MAChBC,MAAM,EAAEN,OAAO,CAACM,MAAM;MACtBC,oBAAoB,EAAEP,OAAO,CAACQ;IAChC,CAAC;IAED,MAAM;MAAE5F,IAAI;MAAEC;IAAM,CAAC,GAAG,MAAMf,QAAQ,CACnCuB,IAAI,CAAC,MAAM,CAAC,CACZoF,MAAM,CAACR,MAAM,CAAC,CACdxD,MAAM,CAAC,CAAC,CACRC,MAAM,CAAC,CAAC;IAEX,IAAI7B,KAAK,EAAE;MACT,MAAM,IAAIG,KAAK,CAACH,KAAK,CAACI,OAAO,CAAC;IAChC;;IAEA;IACA,IAAI+E,OAAO,CAACU,iBAAiB,IAAIV,OAAO,CAACU,iBAAiB,CAACC,MAAM,GAAG,CAAC,EAAE;MACrE,MAAMD,iBAAiB,GAAGV,OAAO,CAACU,iBAAiB,CAACE,GAAG,CAACC,OAAO,KAAK;QAClEC,MAAM,EAAElG,IAAI,CAACO,EAAE;QACfd,IAAI,EAAEwG,OAAO,CAACxG,IAAI;QAClBI,KAAK,EAAEoG,OAAO,CAACpG,KAAK;QACpBN,KAAK,EAAE0G,OAAO,CAAC1G,KAAK;QACpB4G,YAAY,EAAEF,OAAO,CAACE;MACxB,CAAC,CAAC,CAAC;MAEH,MAAM;QAAElG,KAAK,EAAEmG;MAAc,CAAC,GAAG,MAAMlH,QAAQ,CAC5CuB,IAAI,CAAC,wBAAwB,CAAC,CAC9BoF,MAAM,CAACC,iBAAiB,CAAC;MAE5B,IAAIM,aAAa,EAAE;QACjBtF,OAAO,CAACb,KAAK,CAAC,kCAAkC,EAAEmG,aAAa,CAAC;MAClE;IACF;IAEA,OAAOpG,IAAI;EACb,CAAC;EAED;EACAqG,SAAS,EAAE,MAAAA,CAAO9F,EAAE,EAAE6E,OAAO,KAAK;IAChC;IACA,MAAMpB,UAAU,GAAG;MACjBvE,IAAI,EAAE2F,OAAO,CAAC3F,IAAI;MAClB8F,IAAI,EAAEH,OAAO,CAACG,IAAI;MAClBC,KAAK,EAAEJ,OAAO,CAACI,KAAK;MACpBC,GAAG,EAAEL,OAAO,CAACK,GAAG;MAChBC,MAAM,EAAEN,OAAO,CAACM,MAAM;MACtBC,oBAAoB,EAAEP,OAAO,CAACQ;IAChC,CAAC;IAED,MAAM;MAAE5F,IAAI;MAAEC;IAAM,CAAC,GAAG,MAAMf,QAAQ,CACnCuB,IAAI,CAAC,MAAM,CAAC,CACZC,MAAM,CAACsD,UAAU,CAAC,CAClBnD,EAAE,CAAC,IAAI,EAAEN,EAAE,CAAC,CACZsB,MAAM,CAAC,CAAC,CACRC,MAAM,CAAC,CAAC;IAEX,IAAI7B,KAAK,EAAE;MACT,MAAM,IAAIG,KAAK,CAACH,KAAK,CAACI,OAAO,CAAC;IAChC;;IAEA;IACA,IAAI+E,OAAO,CAACU,iBAAiB,IAAIV,OAAO,CAACU,iBAAiB,CAACC,MAAM,GAAG,CAAC,EAAE;MACrE;MACA,MAAM;QAAE9F,KAAK,EAAEqG;MAAY,CAAC,GAAG,MAAMpH,QAAQ,CAC1CuB,IAAI,CAAC,wBAAwB,CAAC,CAC9B8F,MAAM,CAAC,CAAC,CACR1F,EAAE,CAAC,QAAQ,EAAEN,EAAE,CAAC;MAEnB,IAAI+F,WAAW,EAAE;QACfxF,OAAO,CAACb,KAAK,CAAC,oCAAoC,EAAEqG,WAAW,CAAC;MAClE;;MAEA;MACA,MAAMR,iBAAiB,GAAGV,OAAO,CAACU,iBAAiB,CAACE,GAAG,CAACC,OAAO,KAAK;QAClEC,MAAM,EAAE3F,EAAE;QACVd,IAAI,EAAEwG,OAAO,CAACxG,IAAI;QAClBI,KAAK,EAAEoG,OAAO,CAACpG,KAAK;QACpBN,KAAK,EAAE0G,OAAO,CAAC1G,KAAK;QACpB4G,YAAY,EAAEF,OAAO,CAACE;MACxB,CAAC,CAAC,CAAC;MAEH,MAAM;QAAElG,KAAK,EAAEmG;MAAc,CAAC,GAAG,MAAMlH,QAAQ,CAC5CuB,IAAI,CAAC,wBAAwB,CAAC,CAC9BoF,MAAM,CAACC,iBAAiB,CAAC;MAE5B,IAAIM,aAAa,EAAE;QACjBtF,OAAO,CAACb,KAAK,CAAC,kCAAkC,EAAEmG,aAAa,CAAC;MAClE;IACF;IAEA,OAAOpG,IAAI;EACb,CAAC;EAED;EACAwG,SAAS,EAAE,MAAOjG,EAAE,IAAK;IACvB,MAAM;MAAEN;IAAM,CAAC,GAAG,MAAMf,QAAQ,CAC7BuB,IAAI,CAAC,MAAM,CAAC,CACZ8F,MAAM,CAAC,CAAC,CACR1F,EAAE,CAAC,IAAI,EAAEN,EAAE,CAAC;IAEf,IAAIN,KAAK,EAAE;MACT,MAAM,IAAIG,KAAK,CAACH,KAAK,CAACI,OAAO,CAAC;IAChC;IAEA,OAAO,IAAI;EACb,CAAC;EAED;EACAoG,cAAc,EAAE,MAAAA,CAAOlG,EAAE,EAAE2D,IAAI,KAAK;IAClC;IACA,MAAMC,OAAO,GAAGD,IAAI,CAACzE,IAAI,CAAC2E,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,CAAC,CAAC;IAC1C,MAAMC,QAAQ,GAAG,GAAG/D,EAAE,IAAIgE,IAAI,CAACC,GAAG,CAAC,CAAC,IAAIL,OAAO,EAAE;IACjD,MAAMM,QAAQ,GAAG,QAAQH,QAAQ,EAAE;;IAEnC;IACA,MAAM;MAAErE,KAAK,EAAEyE;IAAY,CAAC,GAAG,MAAMxF,QAAQ,CAACyF,OAAO,CAClDlE,IAAI,CAAC,YAAY,CAAC,CAClBmE,MAAM,CAACH,QAAQ,EAAEP,IAAI,CAAC;IAEzB,IAAIQ,WAAW,EAAE;MACf,MAAM,IAAItE,KAAK,CAACsE,WAAW,CAACrE,OAAO,CAAC;IACtC;;IAEA;IACA,MAAM;MAAEL,IAAI,EAAE;QAAE6E;MAAU;IAAE,CAAC,GAAG3F,QAAQ,CAACyF,OAAO,CAC7ClE,IAAI,CAAC,YAAY,CAAC,CAClBqE,YAAY,CAACL,QAAQ,CAAC;;IAEzB;IACA,MAAM;MAAExE,KAAK,EAAE8E;IAAY,CAAC,GAAG,MAAM7F,QAAQ,CAC1CuB,IAAI,CAAC,MAAM,CAAC,CACZC,MAAM,CAAC;MAAEgG,SAAS,EAAE7B;IAAU,CAAC,CAAC,CAChChE,EAAE,CAAC,IAAI,EAAEN,EAAE,CAAC;IAEf,IAAIwE,WAAW,EAAE;MACf,MAAM,IAAI3E,KAAK,CAAC2E,WAAW,CAAC1E,OAAO,CAAC;IACtC;IAEA,OAAOwE,SAAS;EAClB;AACF,CAAC;;AAED;AACA,OAAO,MAAM8B,QAAQ,GAAG;EACtB;EACAC,WAAW,EAAE,MAAOC,MAAM,IAAK;IAC7B,IAAIC,KAAK,GAAG5H,QAAQ,CACjBuB,IAAI,CAAC,UAAU,CAAC,CAChBoB,MAAM,CAAC,GAAG,CAAC;;IAEd;IACA,IAAIgF,MAAM,EAAE;MACV,IAAIA,MAAM,CAACE,UAAU,EAAE;QACrBD,KAAK,GAAGA,KAAK,CAACjG,EAAE,CAAC,aAAa,EAAEgG,MAAM,CAACE,UAAU,CAAC;MACpD;MAEA,IAAIF,MAAM,CAACG,QAAQ,EAAE;QACnBF,KAAK,GAAGA,KAAK,CAACjG,EAAE,CAAC,UAAU,EAAEgG,MAAM,CAACG,QAAQ,CAAC;MAC/C;IACF;IAEA,MAAM;MAAEhH,IAAI;MAAEC;IAAM,CAAC,GAAG,MAAM6G,KAAK;IAEnC,IAAI7G,KAAK,EAAE;MACT,MAAM,IAAIG,KAAK,CAACH,KAAK,CAACI,OAAO,CAAC;IAChC;IAEA,OAAOL,IAAI;EACb,CAAC;EAED;EACAiH,UAAU,EAAE,MAAO1G,EAAE,IAAK;IACxB,MAAM;MAAEP,IAAI,EAAEkH,OAAO;MAAEjH,KAAK,EAAEkH;IAAa,CAAC,GAAG,MAAMjI,QAAQ,CAC1DuB,IAAI,CAAC,UAAU,CAAC,CAChBoB,MAAM,CAAC,GAAG,CAAC,CACXhB,EAAE,CAAC,IAAI,EAAEN,EAAE,CAAC,CACZuB,MAAM,CAAC,CAAC;IAEX,IAAIqF,YAAY,EAAE;MAChB,MAAM,IAAI/G,KAAK,CAAC+G,YAAY,CAAC9G,OAAO,CAAC;IACvC;;IAEA;IACA,MAAM;MAAEL,IAAI,EAAEoH,YAAY;MAAEnH,KAAK,EAAEoH;IAAkB,CAAC,GAAG,MAAMnI,QAAQ,CACpEuB,IAAI,CAAC,sBAAsB,CAAC,CAC5BoB,MAAM,CAAC,GAAG,CAAC,CACXhB,EAAE,CAAC,YAAY,EAAEN,EAAE,CAAC;IAEvB,IAAI8G,iBAAiB,EAAE;MACrBvG,OAAO,CAACb,KAAK,CAAC,8BAA8B,EAAEoH,iBAAiB,CAAC;IAClE;;IAEA;IACA,MAAM;MAAErH,IAAI,EAAEsH,UAAU;MAAErH,KAAK,EAAEsH;IAAU,CAAC,GAAG,MAAMrI,QAAQ,CAC1DuB,IAAI,CAAC,sBAAsB,CAAC,CAC5BoB,MAAM,CAAC,GAAG,CAAC,CACXhB,EAAE,CAAC,YAAY,EAAEN,EAAE,CAAC,CACpBiH,WAAW,CAAC,CAAC;IAEhB,IAAID,SAAS,IAAIA,SAAS,CAACE,IAAI,KAAK,UAAU,EAAE;MAC9C3G,OAAO,CAACb,KAAK,CAAC,6BAA6B,EAAEsH,SAAS,CAAC;IACzD;IAEA,OAAO;MACL,GAAGL,OAAO;MACVE,YAAY,EAAEA,YAAY,IAAI,EAAE;MAChCE,UAAU,EAAEA,UAAU,GAAGA,UAAU,CAACI,WAAW,GAAG;IACpD,CAAC;EACH,CAAC;EAED;EACAC,aAAa,EAAE,MAAOC,WAAW,IAAK;IACpC,MAAM;MAAE5H,IAAI,EAAE;QAAEM;MAAK;IAAE,CAAC,GAAG,MAAMpB,QAAQ,CAACC,IAAI,CAACkE,OAAO,CAAC,CAAC;IAExD,IAAI,CAAC/C,IAAI,EAAE;MACT,MAAM,IAAIF,KAAK,CAAC,mBAAmB,CAAC;IACtC;;IAEA;IACA,MAAMyH,UAAU,GAAG;MACjBC,WAAW,EAAExH,IAAI,CAACC,EAAE;MACpBwH,KAAK,EAAEH,WAAW,CAACG,KAAK;MACxBC,WAAW,EAAEJ,WAAW,CAACI,WAAW;MACpChB,QAAQ,EAAEY,WAAW,CAACZ,QAAQ;MAC9BiB,YAAY,EAAEL,WAAW,CAACM,KAAK,CAACC,MAAM;MACtCC,cAAc,EAAER,WAAW,CAACM,KAAK,CAACG,QAAQ,IAAI,KAAK;MACnDC,QAAQ,EAAEV,WAAW,CAACU,QAAQ;MAC9BC,gBAAgB,EAAEX,WAAW,CAACY,eAAe;MAC7CC,QAAQ,EAAEb,WAAW,CAACa,QAAQ,IAAI,CAAC;MACnCC,WAAW,EAAEd,WAAW,CAACe,UAAU,IAAI;IACzC,CAAC;IAED,MAAM;MAAE3I,IAAI;MAAEC;IAAM,CAAC,GAAG,MAAMf,QAAQ,CACnCuB,IAAI,CAAC,UAAU,CAAC,CAChBoF,MAAM,CAACgC,UAAU,CAAC,CAClBhG,MAAM,CAAC,CAAC,CACRC,MAAM,CAAC,CAAC;IAEX,IAAI7B,KAAK,EAAE;MACT,MAAM,IAAIG,KAAK,CAACH,KAAK,CAACI,OAAO,CAAC;IAChC;;IAEA;IACA,IAAIuH,WAAW,CAACR,YAAY,IAAIQ,WAAW,CAACR,YAAY,CAACrB,MAAM,GAAG,CAAC,EAAE;MACnE,MAAMqB,YAAY,GAAGQ,WAAW,CAACR,YAAY,CAACpB,GAAG,CAAC4C,IAAI,KAAK;QACzDC,UAAU,EAAE7I,IAAI,CAACO,EAAE;QACnBuI,WAAW,EAAEF,IAAI,CAACG,SAAS;QAC3BC,aAAa,EAAEJ,IAAI,CAACK,YAAY;QAChCC,UAAU,EAAEN,IAAI,CAACO,SAAS;QAC1BC,QAAQ,EAAER,IAAI,CAACS,OAAO;QACtBC,YAAY,EAAEV,IAAI,CAACW,WAAW,KAAK;MACrC,CAAC,CAAC,CAAC;MAEH,MAAM;QAAEtJ,KAAK,EAAEoH;MAAkB,CAAC,GAAG,MAAMnI,QAAQ,CAChDuB,IAAI,CAAC,sBAAsB,CAAC,CAC5BoF,MAAM,CAACuB,YAAY,CAAC;MAEvB,IAAIC,iBAAiB,EAAE;QACrBvG,OAAO,CAACb,KAAK,CAAC,4BAA4B,EAAEoH,iBAAiB,CAAC;MAChE;IACF;;IAEA;IACA,IAAIO,WAAW,CAACN,UAAU,EAAE;MAC1B,MAAM;QAAErH,KAAK,EAAEsH;MAAU,CAAC,GAAG,MAAMrI,QAAQ,CACxCuB,IAAI,CAAC,sBAAsB,CAAC,CAC5BoF,MAAM,CAAC;QACNgD,UAAU,EAAE7I,IAAI,CAACO,EAAE;QACnBmH,WAAW,EAAEE,WAAW,CAACN;MAC3B,CAAC,CAAC;MAEJ,IAAIC,SAAS,EAAE;QACbzG,OAAO,CAACb,KAAK,CAAC,2BAA2B,EAAEsH,SAAS,CAAC;MACvD;IACF;IAEA,OAAOvH,IAAI;EACb,CAAC;EAED;EACAwJ,aAAa,EAAE,MAAAA,CAAOjJ,EAAE,EAAEqH,WAAW,KAAK;IACxC;IACA,MAAM5D,UAAU,GAAG;MACjB+D,KAAK,EAAEH,WAAW,CAACG,KAAK;MACxBC,WAAW,EAAEJ,WAAW,CAACI,WAAW;MACpChB,QAAQ,EAAEY,WAAW,CAACZ,QAAQ;MAC9BiB,YAAY,EAAEL,WAAW,CAACM,KAAK,CAACC,MAAM;MACtCC,cAAc,EAAER,WAAW,CAACM,KAAK,CAACG,QAAQ,IAAI,KAAK;MACnDC,QAAQ,EAAEV,WAAW,CAACU,QAAQ;MAC9BC,gBAAgB,EAAEX,WAAW,CAACY,eAAe;MAC7CC,QAAQ,EAAEb,WAAW,CAACa,QAAQ,IAAI,CAAC;MACnCC,WAAW,EAAEd,WAAW,CAACe,UAAU,IAAI;IACzC,CAAC;IAED,MAAM;MAAE3I,IAAI;MAAEC;IAAM,CAAC,GAAG,MAAMf,QAAQ,CACnCuB,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAACsD,UAAU,CAAC,CAClBnD,EAAE,CAAC,IAAI,EAAEN,EAAE,CAAC,CACZsB,MAAM,CAAC,CAAC,CACRC,MAAM,CAAC,CAAC;IAEX,IAAI7B,KAAK,EAAE;MACT,MAAM,IAAIG,KAAK,CAACH,KAAK,CAACI,OAAO,CAAC;IAChC;;IAEA;IACA,IAAIuH,WAAW,CAACR,YAAY,IAAIQ,WAAW,CAACR,YAAY,CAACrB,MAAM,GAAG,CAAC,EAAE;MACnE;MACA,MAAM;QAAE9F,KAAK,EAAEqG;MAAY,CAAC,GAAG,MAAMpH,QAAQ,CAC1CuB,IAAI,CAAC,sBAAsB,CAAC,CAC5B8F,MAAM,CAAC,CAAC,CACR1F,EAAE,CAAC,YAAY,EAAEN,EAAE,CAAC;MAEvB,IAAI+F,WAAW,EAAE;QACfxF,OAAO,CAACb,KAAK,CAAC,8BAA8B,EAAEqG,WAAW,CAAC;MAC5D;;MAEA;MACA,MAAMc,YAAY,GAAGQ,WAAW,CAACR,YAAY,CAACpB,GAAG,CAAC4C,IAAI,KAAK;QACzDC,UAAU,EAAEtI,EAAE;QACduI,WAAW,EAAEF,IAAI,CAACG,SAAS;QAC3BC,aAAa,EAAEJ,IAAI,CAACK,YAAY;QAChCC,UAAU,EAAEN,IAAI,CAACO,SAAS;QAC1BC,QAAQ,EAAER,IAAI,CAACS,OAAO;QACtBC,YAAY,EAAEV,IAAI,CAACW,WAAW,KAAK;MACrC,CAAC,CAAC,CAAC;MAEH,MAAM;QAAEtJ,KAAK,EAAEoH;MAAkB,CAAC,GAAG,MAAMnI,QAAQ,CAChDuB,IAAI,CAAC,sBAAsB,CAAC,CAC5BoF,MAAM,CAACuB,YAAY,CAAC;MAEvB,IAAIC,iBAAiB,EAAE;QACrBvG,OAAO,CAACb,KAAK,CAAC,4BAA4B,EAAEoH,iBAAiB,CAAC;MAChE;IACF;;IAEA;IACA,IAAIO,WAAW,CAACN,UAAU,EAAE;MAC1B;MACA,MAAM;QAAEtH,IAAI,EAAEyJ,YAAY;QAAExJ,KAAK,EAAEyJ;MAAW,CAAC,GAAG,MAAMxK,QAAQ,CAC7DuB,IAAI,CAAC,sBAAsB,CAAC,CAC5BoB,MAAM,CAAC,IAAI,CAAC,CACZhB,EAAE,CAAC,YAAY,EAAEN,EAAE,CAAC,CACpBiH,WAAW,CAAC,CAAC;MAEhB,IAAIkC,UAAU,IAAIA,UAAU,CAACjC,IAAI,KAAK,UAAU,EAAE;QAChD3G,OAAO,CAACb,KAAK,CAAC,6BAA6B,EAAEyJ,UAAU,CAAC;MAC1D;MAEA,IAAID,YAAY,EAAE;QAChB;QACA,MAAM;UAAExJ,KAAK,EAAE8E;QAAY,CAAC,GAAG,MAAM7F,QAAQ,CAC1CuB,IAAI,CAAC,sBAAsB,CAAC,CAC5BC,MAAM,CAAC;UAAEgH,WAAW,EAAEE,WAAW,CAACN;QAAW,CAAC,CAAC,CAC/CzG,EAAE,CAAC,IAAI,EAAE4I,YAAY,CAAClJ,EAAE,CAAC;QAE5B,IAAIwE,WAAW,EAAE;UACfjE,OAAO,CAACb,KAAK,CAAC,6BAA6B,EAAE8E,WAAW,CAAC;QAC3D;MACF,CAAC,MAAM;QACL;QACA,MAAM;UAAE9E,KAAK,EAAE0J;QAAY,CAAC,GAAG,MAAMzK,QAAQ,CAC1CuB,IAAI,CAAC,sBAAsB,CAAC,CAC5BoF,MAAM,CAAC;UACNgD,UAAU,EAAEtI,EAAE;UACdmH,WAAW,EAAEE,WAAW,CAACN;QAC3B,CAAC,CAAC;QAEJ,IAAIqC,WAAW,EAAE;UACf7I,OAAO,CAACb,KAAK,CAAC,2BAA2B,EAAE0J,WAAW,CAAC;QACzD;MACF;IACF;IAEA,OAAO3J,IAAI;EACb,CAAC;EAED;EACA4J,aAAa,EAAE,MAAOrJ,EAAE,IAAK;IAC3B,MAAM;MAAEN;IAAM,CAAC,GAAG,MAAMf,QAAQ,CAC7BuB,IAAI,CAAC,UAAU,CAAC,CAChB8F,MAAM,CAAC,CAAC,CACR1F,EAAE,CAAC,IAAI,EAAEN,EAAE,CAAC;IAEf,IAAIN,KAAK,EAAE;MACT,MAAM,IAAIG,KAAK,CAACH,KAAK,CAACI,OAAO,CAAC;IAChC;IAEA,OAAO,IAAI;EACb;AACF,CAAC;;AAED;AACA,OAAO,MAAMwJ,QAAQ,GAAG;EACtB;EACAC,WAAW,EAAE,MAAOjD,MAAM,IAAK;IAAA,IAAAkD,oBAAA,EAAAC,oBAAA;IAC7B,MAAM;MAAEhK,IAAI,EAAE;QAAEM;MAAK;IAAE,CAAC,GAAG,MAAMpB,QAAQ,CAACC,IAAI,CAACkE,OAAO,CAAC,CAAC;IAExD,IAAI,CAAC/C,IAAI,EAAE;MACT,MAAM,IAAIF,KAAK,CAAC,mBAAmB,CAAC;IACtC;IAEA,IAAI0G,KAAK,GAAG5H,QAAQ,CACjBuB,IAAI,CAAC,UAAU,CAAC,CAChBoB,MAAM,CAAC;AACd;AACA;AACA;AACA,OAAO,CAAC;;IAEJ;IACA,IAAI,EAAAkI,oBAAA,GAAAzJ,IAAI,CAACyB,aAAa,cAAAgI,oBAAA,uBAAlBA,oBAAA,CAAoBrK,IAAI,MAAK,QAAQ,EAAE;MACzCoH,KAAK,GAAGA,KAAK,CAACjG,EAAE,CAAC,WAAW,EAAEP,IAAI,CAACC,EAAE,CAAC;IACxC,CAAC,MAAM,IAAI,EAAAyJ,oBAAA,GAAA1J,IAAI,CAACyB,aAAa,cAAAiI,oBAAA,uBAAlBA,oBAAA,CAAoBtK,IAAI,MAAK,UAAU,EAAE;MAClDoH,KAAK,GAAGA,KAAK,CAACjG,EAAE,CAAC,aAAa,EAAEP,IAAI,CAACC,EAAE,CAAC;IAC1C;IAEA,IAAIsG,MAAM,EAAE;MACV,IAAIA,MAAM,CAACoD,MAAM,EAAE;QACjBnD,KAAK,GAAGA,KAAK,CAACjG,EAAE,CAAC,QAAQ,EAAEgG,MAAM,CAACoD,MAAM,CAAC;MAC3C;MAEA,IAAIpD,MAAM,CAACqD,SAAS,IAAIrD,MAAM,CAACsD,OAAO,EAAE;QACtCrD,KAAK,GAAGA,KAAK,CACVsD,GAAG,CAAC,YAAY,EAAEvD,MAAM,CAACqD,SAAS,CAAC,CACnCG,GAAG,CAAC,YAAY,EAAExD,MAAM,CAACsD,OAAO,CAAC;MACtC;IACF;;IAEA;IACArD,KAAK,GAAGA,KAAK,CAACwD,KAAK,CAAC,YAAY,EAAE;MAAEC,SAAS,EAAE;IAAM,CAAC,CAAC;IAEvD,MAAM;MAAEvK,IAAI;MAAEC;IAAM,CAAC,GAAG,MAAM6G,KAAK;IAEnC,IAAI7G,KAAK,EAAE;MACT,MAAM,IAAIG,KAAK,CAACH,KAAK,CAACI,OAAO,CAAC;IAChC;IAEA,OAAOL,IAAI;EACb,CAAC;EAED;EACAwK,UAAU,EAAE,MAAOjK,EAAE,IAAK;IACxB,MAAM;MAAEP,IAAI;MAAEC;IAAM,CAAC,GAAG,MAAMf,QAAQ,CACnCuB,IAAI,CAAC,UAAU,CAAC,CAChBoB,MAAM,CAAC;AACd;AACA;AACA;AACA,OAAO,CAAC,CACDhB,EAAE,CAAC,IAAI,EAAEN,EAAE,CAAC,CACZuB,MAAM,CAAC,CAAC;IAEX,IAAI7B,KAAK,EAAE;MACT,MAAM,IAAIG,KAAK,CAACH,KAAK,CAACI,OAAO,CAAC;IAChC;IAEA,OAAOL,IAAI;EACb,CAAC;EAED;EACAyK,aAAa,EAAE,MAAOC,WAAW,IAAK;IAAA,IAAAC,kBAAA,EAAAC,mBAAA,EAAAC,mBAAA;IACpC,MAAM;MAAE7K,IAAI,EAAE;QAAEM;MAAK;IAAE,CAAC,GAAG,MAAMpB,QAAQ,CAACC,IAAI,CAACkE,OAAO,CAAC,CAAC;IAExD,IAAI,CAAC/C,IAAI,EAAE;MACT,MAAM,IAAIF,KAAK,CAAC,mBAAmB,CAAC;IACtC;;IAEA;IACA,MAAM;MAAEJ,IAAI,EAAEkH,OAAO;MAAEjH,KAAK,EAAEkH;IAAa,CAAC,GAAG,MAAMjI,QAAQ,CAC1DuB,IAAI,CAAC,UAAU,CAAC,CAChBoB,MAAM,CAAC,2CAA2C,CAAC,CACnDhB,EAAE,CAAC,IAAI,EAAE6J,WAAW,CAACI,SAAS,CAAC,CAC/BhJ,MAAM,CAAC,CAAC;IAEX,IAAIqF,YAAY,EAAE;MAChB,MAAM,IAAI/G,KAAK,CAAC,mBAAmB,CAAC;IACtC;;IAEA;IACA,MAAM2K,UAAU,GAAG;MACjBlC,UAAU,EAAE6B,WAAW,CAACI,SAAS;MACjChD,WAAW,EAAE4C,WAAW,CAAC3D,UAAU,IAAIG,OAAO,CAACY,WAAW;MAC1DkD,SAAS,EAAE1K,IAAI,CAACC,EAAE;MAClB2F,MAAM,EAAEwE,WAAW,CAACO,KAAK;MACzB/B,UAAU,EAAE,IAAI3E,IAAI,CAACmG,WAAW,CAACvB,SAAS,CAAC,CAAC+B,WAAW,CAAC,CAAC;MACzD9B,QAAQ,EAAE,IAAI7E,IAAI,CAACmG,WAAW,CAACrB,OAAO,CAAC,CAAC6B,WAAW,CAAC,CAAC;MACrDtI,QAAQ,EAAE8H,WAAW,CAAC9H,QAAQ;MAC9BuI,kBAAkB,EAAEjE,OAAO,CAACe,YAAY;MACxCmD,oBAAoB,EAAElE,OAAO,CAACkB,cAAc,IAAI,KAAK;MACrDiD,YAAY,EAAE,EAAAV,kBAAA,GAAAD,WAAW,CAACY,KAAK,cAAAX,kBAAA,uBAAjBA,kBAAA,CAAmBY,MAAM,KAAI,IAAI;MAC/CC,cAAc,EAAE,EAAAZ,mBAAA,GAAAF,WAAW,CAACY,KAAK,cAAAV,mBAAA,uBAAjBA,mBAAA,CAAmBa,QAAQ,KAAI,IAAI;MACnDC,cAAc,EAAE,EAAAb,mBAAA,GAAAH,WAAW,CAACY,KAAK,cAAAT,mBAAA,uBAAjBA,mBAAA,CAAmBc,QAAQ,KAAI,IAAI;MACnDC,gBAAgB,EAAElB,WAAW,CAACmB,cAAc,IAAI,IAAI;MACpD5B,MAAM,EAAE;IACV,CAAC;IAED,MAAM;MAAEjK,IAAI;MAAEC;IAAM,CAAC,GAAG,MAAMf,QAAQ,CACnCuB,IAAI,CAAC,UAAU,CAAC,CAChBoF,MAAM,CAACkF,UAAU,CAAC,CAClBlJ,MAAM,CAAC,CAAC,CACRC,MAAM,CAAC,CAAC;IAEX,IAAI7B,KAAK,EAAE;MACT,MAAM,IAAIG,KAAK,CAACH,KAAK,CAACI,OAAO,CAAC;IAChC;IAEA,OAAOL,IAAI;EACb,CAAC;EAED;EACA8L,aAAa,EAAE,MAAAA,CAAOvL,EAAE,EAAEmK,WAAW,KAAK;IACxC;IACA,MAAM1G,UAAU,GAAG,CAAC,CAAC;IAErB,IAAI0G,WAAW,CAACvB,SAAS,EAAE;MACzBnF,UAAU,CAACkF,UAAU,GAAG,IAAI3E,IAAI,CAACmG,WAAW,CAACvB,SAAS,CAAC,CAAC+B,WAAW,CAAC,CAAC;IACvE;IAEA,IAAIR,WAAW,CAACrB,OAAO,EAAE;MACvBrF,UAAU,CAACoF,QAAQ,GAAG,IAAI7E,IAAI,CAACmG,WAAW,CAACrB,OAAO,CAAC,CAAC6B,WAAW,CAAC,CAAC;IACnE;IAEA,IAAIR,WAAW,CAACT,MAAM,EAAE;MACtBjG,UAAU,CAACiG,MAAM,GAAGS,WAAW,CAACT,MAAM;IACxC;IAEA,IAAIS,WAAW,CAACY,KAAK,EAAE;MACrB,IAAIZ,WAAW,CAACY,KAAK,CAACC,MAAM,KAAKQ,SAAS,EAAE;QAC1C/H,UAAU,CAACqH,YAAY,GAAGX,WAAW,CAACY,KAAK,CAACC,MAAM;MACpD;MAEA,IAAIb,WAAW,CAACY,KAAK,CAACG,QAAQ,KAAKM,SAAS,EAAE;QAC5C/H,UAAU,CAACwH,cAAc,GAAGd,WAAW,CAACY,KAAK,CAACG,QAAQ;MACxD;MAEA,IAAIf,WAAW,CAACY,KAAK,CAACK,QAAQ,KAAKI,SAAS,EAAE;QAC5C/H,UAAU,CAAC0H,cAAc,GAAGhB,WAAW,CAACY,KAAK,CAACK,QAAQ;MACxD;IACF;IAEA,IAAIjB,WAAW,CAACsB,aAAa,EAAE;MAC7BhI,UAAU,CAACiI,iBAAiB,GAAGvB,WAAW,CAACsB,aAAa;IAC1D;IAEA,MAAM;MAAEhM,IAAI;MAAEC;IAAM,CAAC,GAAG,MAAMf,QAAQ,CACnCuB,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAACsD,UAAU,CAAC,CAClBnD,EAAE,CAAC,IAAI,EAAEN,EAAE,CAAC,CACZsB,MAAM,CAAC,CAAC,CACRC,MAAM,CAAC,CAAC;IAEX,IAAI7B,KAAK,EAAE;MACT,MAAM,IAAIG,KAAK,CAACH,KAAK,CAACI,OAAO,CAAC;IAChC;IAEA,OAAOL,IAAI;EACb,CAAC;EAED;EACAkM,aAAa,EAAE,MAAAA,CAAO3L,EAAE,EAAE4L,MAAM,KAAK;IAAA,IAAAC,oBAAA;IACnC,MAAM;MAAEpM,IAAI,EAAE;QAAEM;MAAK;IAAE,CAAC,GAAG,MAAMpB,QAAQ,CAACC,IAAI,CAACkE,OAAO,CAAC,CAAC;IAExD,IAAI,CAAC/C,IAAI,EAAE;MACT,MAAM,IAAIF,KAAK,CAAC,mBAAmB,CAAC;IACtC;;IAEA;IACA,MAAM;MAAEJ,IAAI,EAAEqM,OAAO;MAAEpM,KAAK,EAAEqM;IAAa,CAAC,GAAG,MAAMpN,QAAQ,CAC1DuB,IAAI,CAAC,UAAU,CAAC,CAChBoB,MAAM,CAAC,wBAAwB,CAAC,CAChChB,EAAE,CAAC,IAAI,EAAEN,EAAE,CAAC,CACZuB,MAAM,CAAC,CAAC;IAEX,IAAIwK,YAAY,EAAE;MAChB,MAAM,IAAIlM,KAAK,CAAC,mBAAmB,CAAC;IACtC;;IAEA;IACA,IAAImM,cAAc;IAClB,IAAIF,OAAO,CAACrB,SAAS,KAAK1K,IAAI,CAACC,EAAE,EAAE;MACjCgM,cAAc,GAAG,QAAQ;IAC3B,CAAC,MAAM,IAAIF,OAAO,CAACvE,WAAW,KAAKxH,IAAI,CAACC,EAAE,EAAE;MAC1CgM,cAAc,GAAG,UAAU;IAC7B,CAAC,MAAM,IAAI,EAAAH,oBAAA,GAAA9L,IAAI,CAACyB,aAAa,cAAAqK,oBAAA,uBAAlBA,oBAAA,CAAoB1M,IAAI,MAAK,OAAO,EAAE;MAC/C6M,cAAc,GAAG,OAAO;IAC1B,CAAC,MAAM;MACL,MAAM,IAAInM,KAAK,CAAC,uCAAuC,CAAC;IAC1D;;IAEA;IACA,MAAM;MAAEJ,IAAI;MAAEC;IAAM,CAAC,GAAG,MAAMf,QAAQ,CACnCuB,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC;MACNuJ,MAAM,EAAE,WAAW;MACnBuC,mBAAmB,EAAEL,MAAM,IAAI,oBAAoB;MACnDM,iBAAiB,EAAE,IAAIlI,IAAI,CAAC,CAAC,CAAC2G,WAAW,CAAC,CAAC;MAC3CwB,eAAe,EAAEH;IACnB,CAAC,CAAC,CACD1L,EAAE,CAAC,IAAI,EAAEN,EAAE,CAAC,CACZsB,MAAM,CAAC,CAAC,CACRC,MAAM,CAAC,CAAC;IAEX,IAAI7B,KAAK,EAAE;MACT,MAAM,IAAIG,KAAK,CAACH,KAAK,CAACI,OAAO,CAAC;IAChC;IAEA,OAAOL,IAAI;EACb,CAAC;EAED;EACA2M,eAAe,EAAE,MAAOpM,EAAE,IAAK;IAC7B,MAAM;MAAEP,IAAI;MAAEC;IAAM,CAAC,GAAG,MAAMf,QAAQ,CACnCuB,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC;MAAEuJ,MAAM,EAAE;IAAY,CAAC,CAAC,CAC/BpJ,EAAE,CAAC,IAAI,EAAEN,EAAE,CAAC,CACZsB,MAAM,CAAC,CAAC,CACRC,MAAM,CAAC,CAAC;IAEX,IAAI7B,KAAK,EAAE;MACT,MAAM,IAAIG,KAAK,CAACH,KAAK,CAACI,OAAO,CAAC;IAChC;IAEA,OAAOL,IAAI;EACb,CAAC;EAED;EACA4M,SAAS,EAAE,MAAAA,CAAOC,SAAS,EAAEC,UAAU,KAAK;IAC1C,MAAM;MAAE9M,IAAI,EAAE;QAAEM;MAAK;IAAE,CAAC,GAAG,MAAMpB,QAAQ,CAACC,IAAI,CAACkE,OAAO,CAAC,CAAC;IAExD,IAAI,CAAC/C,IAAI,EAAE;MACT,MAAM,IAAIF,KAAK,CAAC,mBAAmB,CAAC;IACtC;;IAEA;IACA,MAAM;MAAEJ,IAAI,EAAEqM,OAAO;MAAEpM,KAAK,EAAEqM;IAAa,CAAC,GAAG,MAAMpN,QAAQ,CAC1DuB,IAAI,CAAC,UAAU,CAAC,CAChBoB,MAAM,CAAC,gCAAgC,CAAC,CACxChB,EAAE,CAAC,IAAI,EAAEgM,SAAS,CAAC,CACnB/K,MAAM,CAAC,CAAC;IAEX,IAAIwK,YAAY,EAAE;MAChB,MAAM,IAAIlM,KAAK,CAAC,mBAAmB,CAAC;IACtC;;IAEA;IACA,IAAIiM,OAAO,CAACrB,SAAS,KAAK1K,IAAI,CAACC,EAAE,EAAE;MACjC,MAAM,IAAIH,KAAK,CAAC,uCAAuC,CAAC;IAC1D;;IAEA;IACA,IAAIiM,OAAO,CAACpC,MAAM,KAAK,WAAW,EAAE;MAClC,MAAM,IAAI7J,KAAK,CAAC,oCAAoC,CAAC;IACvD;;IAEA;IACA,MAAM2M,SAAS,GAAG;MAChBC,UAAU,EAAEH,SAAS;MACrB7B,SAAS,EAAE1K,IAAI,CAACC,EAAE;MAClBuH,WAAW,EAAEuE,OAAO,CAACvE,WAAW;MAChCmF,MAAM,EAAEH,UAAU,CAACG,MAAM;MACzBC,OAAO,EAAEJ,UAAU,CAACI,OAAO,IAAI;IACjC,CAAC;IAED,MAAM;MAAElN,IAAI;MAAEC;IAAM,CAAC,GAAG,MAAMf,QAAQ,CACnCuB,IAAI,CAAC,SAAS,CAAC,CACfoF,MAAM,CAACkH,SAAS,CAAC,CACjBlL,MAAM,CAAC,CAAC,CACRC,MAAM,CAAC,CAAC;IAEX,IAAI7B,KAAK,EAAE;MACT,MAAM,IAAIG,KAAK,CAACH,KAAK,CAACI,OAAO,CAAC;IAChC;IAEA,OAAOL,IAAI;EACb;AACF,CAAC;;AAED;AACA,OAAO,MAAMmN,QAAQ,GAAG;EACtB;EACAC,mBAAmB,EAAE,MAAOP,SAAS,IAAK;IACxC;IACA;;IAEA,MAAM;MAAE7M,IAAI,EAAE;QAAEsB;MAAQ;IAAE,CAAC,GAAG,MAAMpC,QAAQ,CAACC,IAAI,CAACoD,UAAU,CAAC,CAAC;IAE9D,IAAI,CAACjB,OAAO,EAAE;MACZ,MAAM,IAAIlB,KAAK,CAAC,mBAAmB,CAAC;IACtC;IAEA,MAAMiN,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,IAAI,2BAA2B,yBAAyB,EAAE;MACrHC,MAAM,EAAE,MAAM;MACdC,OAAO,EAAE;QACP,cAAc,EAAE,kBAAkB;QAClC,eAAe,EAAE,UAAUrM,OAAO,CAACsM,YAAY;MACjD,CAAC;MACDC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;QAAElB;MAAU,CAAC;IACpC,CAAC,CAAC;IAEF,MAAM7M,IAAI,GAAG,MAAMqN,QAAQ,CAACW,IAAI,CAAC,CAAC;IAElC,IAAI,CAACX,QAAQ,CAACY,EAAE,EAAE;MAChB,MAAM,IAAI7N,KAAK,CAACJ,IAAI,CAACC,KAAK,IAAI,iCAAiC,CAAC;IAClE;IAEA,OAAOD,IAAI;EACb;AACF,CAAC;;AAGD;AACA,eAAe;EACbb,IAAI;EACJ8D,KAAK;EACL+B,IAAI;EACJ2B,QAAQ;EACRkD,QAAQ;EACRsD,QAAQ;EACRe;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}