{"ast":null,"code":"import React,{createContext,useState,useEffect,useContext}from'react';import{useNavigate}from'react-router-dom';import api from'../services/api';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const useAuth=()=>useContext(AuthContext);export const AuthProvider=_ref=>{let{children}=_ref;const[currentUser,setCurrentUser]=useState(null);const[token,setToken]=useState(localStorage.getItem('token')||null);const[authLoading,setAuthLoading]=useState(true);const[error,setError]=useState(null);const navigate=useNavigate();// Check if user is already logged in on mount\nuseEffect(()=>{const checkLoggedIn=async()=>{if(token){try{// Set the token in the API headers\napi.setAuthToken(token);// Check if this is a demo token\nif(token.startsWith('mock-bypass-token-')){// For demo tokens, we already have the user data in localStorage\nconst demoUserData=JSON.parse(localStorage.getItem('demoUser')||'{}');if(demoUserData.id){setCurrentUser(demoUserData);setAuthLoading(false);return;}}// For real tokens, get user info from API\ntry{const response=await api.get('/users/me');setCurrentUser(response.data.user);}catch(apiErr){console.log('API error, using demo mode');// If API call fails but we have a token, create a mock user for demo\nif(token){const demoUser={id:'demo-user-123',name:'Demo User',email:'demo@example.com',role:'business',businessId:'demo-business-456'};setCurrentUser(demoUser);}}}catch(err){console.error('Authentication error:',err);// Don't clear token in demo mode\nif(!token.startsWith('mock-bypass-token-')){localStorage.removeItem('token');setToken(null);setCurrentUser(null);}}}setAuthLoading(false);};checkLoggedIn();},[token]);// Register user\nconst register=async userData=>{try{setError(null);setAuthLoading(true);const response=await api.post('/auth/register',userData);// Save token and set user\nlocalStorage.setItem('token',response.data.token);setToken(response.data.token);setCurrentUser(response.data.user);// Set token in API headers\napi.setAuthToken(response.data.token);setAuthLoading(false);return response.data;}catch(err){var _err$response,_err$response$data;setAuthLoading(false);setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.error)||'An error occurred during registration. Please try again.');throw err;}};// Login user\nconst login=async credentials=>{try{setError(null);setAuthLoading(true);// In a real production app, this would make an actual API call\n// For development purposes, we're providing a bypass option\nconst response=await api.post('/auth/login',credentials);// Save token and set user\nlocalStorage.setItem('token',response.data.token);setToken(response.data.token);setCurrentUser(response.data.user);// Set token in API headers\napi.setAuthToken(response.data.token);setAuthLoading(false);return response.data;}catch(err){var _err$response2,_err$response2$data;setAuthLoading(false);setError(((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.error)||'Invalid credentials. Please try again.');throw err;}};// Logout user\nconst logout=()=>{localStorage.removeItem('token');setToken(null);setCurrentUser(null);api.removeAuthToken();navigate('/login');};// Update user profile\nconst updateProfile=async profileData=>{try{setError(null);setAuthLoading(true);const response=await api.put('/users/profile',profileData);setCurrentUser({...currentUser,...response.data.user});setAuthLoading(false);return response.data;}catch(err){var _err$response3,_err$response3$data;setAuthLoading(false);setError(((_err$response3=err.response)===null||_err$response3===void 0?void 0:(_err$response3$data=_err$response3.data)===null||_err$response3$data===void 0?void 0:_err$response3$data.error)||'An error occurred while updating profile. Please try again.');throw err;}};// For demo purposes - bypass authentication\nconst setBypassAuth=userData=>{// Create a mock token\nconst mockToken='mock-bypass-token-'+Date.now();// Save both token and user data to localStorage\nlocalStorage.setItem('token',mockToken);localStorage.setItem('demoUser',JSON.stringify(userData));// Update state\nsetToken(mockToken);setCurrentUser(userData);// Set up mock auth header\napi.setAuthToken(mockToken);// Dispatch an event to notify other components of auth change\nwindow.dispatchEvent(new Event('authChange'));};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{currentUser,token,authLoading,error,register,login,logout,updateProfile,setBypassAuth,isAuthenticated:!!token},children:children});};export default AuthContext;","map":{"version":3,"names":["React","createContext","useState","useEffect","useContext","useNavigate","api","jsx","_jsx","AuthContext","useAuth","AuthProvider","_ref","children","currentUser","setCurrentUser","token","setToken","localStorage","getItem","authLoading","setAuthLoading","error","setError","navigate","checkLoggedIn","setAuthToken","startsWith","demoUserData","JSON","parse","id","response","get","data","user","apiErr","console","log","demoUser","name","email","role","businessId","err","removeItem","register","userData","post","setItem","_err$response","_err$response$data","login","credentials","_err$response2","_err$response2$data","logout","removeAuthToken","updateProfile","profileData","put","_err$response3","_err$response3$data","setBypassAuth","mockToken","Date","now","stringify","window","dispatchEvent","Event","Provider","value","isAuthenticated"],"sources":["/home/toebot/dog-services-saas/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect, useContext } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport api from '../services/api';\n\nconst AuthContext = createContext();\n\nexport const useAuth = () => useContext(AuthContext);\n\nexport const AuthProvider = ({ children }) => {\n  const [currentUser, setCurrentUser] = useState(null);\n  const [token, setToken] = useState(localStorage.getItem('token') || null);\n  const [authLoading, setAuthLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const navigate = useNavigate();\n\n  // Check if user is already logged in on mount\n  useEffect(() => {\n    const checkLoggedIn = async () => {\n      if (token) {\n        try {\n          // Set the token in the API headers\n          api.setAuthToken(token);\n          \n          // Check if this is a demo token\n          if (token.startsWith('mock-bypass-token-')) {\n            // For demo tokens, we already have the user data in localStorage\n            const demoUserData = JSON.parse(localStorage.getItem('demoUser') || '{}');\n            if (demoUserData.id) {\n              setCurrentUser(demoUserData);\n              setAuthLoading(false);\n              return;\n            }\n          }\n          \n          // For real tokens, get user info from API\n          try {\n            const response = await api.get('/users/me');\n            setCurrentUser(response.data.user);\n          } catch (apiErr) {\n            console.log('API error, using demo mode');\n            // If API call fails but we have a token, create a mock user for demo\n            if (token) {\n              const demoUser = {\n                id: 'demo-user-123',\n                name: 'Demo User',\n                email: 'demo@example.com',\n                role: 'business',\n                businessId: 'demo-business-456'\n              };\n              setCurrentUser(demoUser);\n            }\n          }\n        } catch (err) {\n          console.error('Authentication error:', err);\n          // Don't clear token in demo mode\n          if (!token.startsWith('mock-bypass-token-')) {\n            localStorage.removeItem('token');\n            setToken(null);\n            setCurrentUser(null);\n          }\n        }\n      }\n      setAuthLoading(false);\n    };\n\n    checkLoggedIn();\n  }, [token]);\n\n  // Register user\n  const register = async (userData) => {\n    try {\n      setError(null);\n      setAuthLoading(true);\n      \n      const response = await api.post('/auth/register', userData);\n      \n      // Save token and set user\n      localStorage.setItem('token', response.data.token);\n      setToken(response.data.token);\n      setCurrentUser(response.data.user);\n      \n      // Set token in API headers\n      api.setAuthToken(response.data.token);\n      \n      setAuthLoading(false);\n      return response.data;\n    } catch (err) {\n      setAuthLoading(false);\n      setError(\n        err.response?.data?.error || \n        'An error occurred during registration. Please try again.'\n      );\n      throw err;\n    }\n  };\n\n  // Login user\n  const login = async (credentials) => {\n    try {\n      setError(null);\n      setAuthLoading(true);\n      \n      // In a real production app, this would make an actual API call\n      // For development purposes, we're providing a bypass option\n      \n      const response = await api.post('/auth/login', credentials);\n      \n      // Save token and set user\n      localStorage.setItem('token', response.data.token);\n      setToken(response.data.token);\n      setCurrentUser(response.data.user);\n      \n      // Set token in API headers\n      api.setAuthToken(response.data.token);\n      \n      setAuthLoading(false);\n      return response.data;\n    } catch (err) {\n      setAuthLoading(false);\n      setError(\n        err.response?.data?.error || \n        'Invalid credentials. Please try again.'\n      );\n      throw err;\n    }\n  };\n\n  // Logout user\n  const logout = () => {\n    localStorage.removeItem('token');\n    setToken(null);\n    setCurrentUser(null);\n    api.removeAuthToken();\n    navigate('/login');\n  };\n\n  // Update user profile\n  const updateProfile = async (profileData) => {\n    try {\n      setError(null);\n      setAuthLoading(true);\n      \n      const response = await api.put('/users/profile', profileData);\n      \n      setCurrentUser({\n        ...currentUser,\n        ...response.data.user\n      });\n      \n      setAuthLoading(false);\n      return response.data;\n    } catch (err) {\n      setAuthLoading(false);\n      setError(\n        err.response?.data?.error || \n        'An error occurred while updating profile. Please try again.'\n      );\n      throw err;\n    }\n  };\n\n  // For demo purposes - bypass authentication\n  const setBypassAuth = (userData) => {\n    // Create a mock token\n    const mockToken = 'mock-bypass-token-' + Date.now();\n    \n    // Save both token and user data to localStorage\n    localStorage.setItem('token', mockToken);\n    localStorage.setItem('demoUser', JSON.stringify(userData));\n    \n    // Update state\n    setToken(mockToken);\n    setCurrentUser(userData);\n    \n    // Set up mock auth header\n    api.setAuthToken(mockToken);\n    \n    // Dispatch an event to notify other components of auth change\n    window.dispatchEvent(new Event('authChange'));\n  };\n\n  return (\n    <AuthContext.Provider\n      value={{\n        currentUser,\n        token,\n        authLoading,\n        error,\n        register,\n        login,\n        logout,\n        updateProfile,\n        setBypassAuth,\n        isAuthenticated: !!token,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport default AuthContext;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}