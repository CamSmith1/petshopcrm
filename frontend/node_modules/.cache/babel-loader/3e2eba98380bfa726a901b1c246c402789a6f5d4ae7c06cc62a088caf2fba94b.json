{"ast":null,"code":"import React,{createContext,useState,useEffect,useContext}from'react';import{useNavigate}from'react-router-dom';import api from'../services/api';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const useAuth=()=>useContext(AuthContext);export const AuthProvider=_ref=>{let{children}=_ref;const[currentUser,setCurrentUser]=useState(null);const[token,setToken]=useState(localStorage.getItem('token')||null);const[authLoading,setAuthLoading]=useState(true);const[error,setError]=useState(null);const navigate=useNavigate();// Check if user is already logged in on mount\nuseEffect(()=>{const checkLoggedIn=async()=>{if(token){try{// Set the token in the API headers\napi.setAuthToken(token);// Get user info\nconst response=await api.get('/users/me');setCurrentUser(response.data.user);}catch(err){console.error('Authentication error:',err);// Clear invalid token\nlocalStorage.removeItem('token');setToken(null);setCurrentUser(null);}}setAuthLoading(false);};checkLoggedIn();},[token]);// Register user\nconst register=async userData=>{try{setError(null);setAuthLoading(true);const response=await api.post('/auth/register',userData);// Save token and set user\nlocalStorage.setItem('token',response.data.token);setToken(response.data.token);setCurrentUser(response.data.user);// Set token in API headers\napi.setAuthToken(response.data.token);setAuthLoading(false);return response.data;}catch(err){var _err$response,_err$response$data;setAuthLoading(false);setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.error)||'An error occurred during registration. Please try again.');throw err;}};// Login user\nconst login=async credentials=>{try{setError(null);setAuthLoading(true);// In a real production app, this would make an actual API call\n// For development purposes, we're providing a bypass option\nconst response=await api.post('/auth/login',credentials);// Save token and set user\nlocalStorage.setItem('token',response.data.token);setToken(response.data.token);setCurrentUser(response.data.user);// Set token in API headers\napi.setAuthToken(response.data.token);setAuthLoading(false);return response.data;}catch(err){var _err$response2,_err$response2$data;setAuthLoading(false);setError(((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.error)||'Invalid credentials. Please try again.');throw err;}};// Logout user\nconst logout=()=>{localStorage.removeItem('token');setToken(null);setCurrentUser(null);api.removeAuthToken();navigate('/login');};// Update user profile\nconst updateProfile=async profileData=>{try{setError(null);setAuthLoading(true);const response=await api.put('/users/profile',profileData);setCurrentUser({...currentUser,...response.data.user});setAuthLoading(false);return response.data;}catch(err){var _err$response3,_err$response3$data;setAuthLoading(false);setError(((_err$response3=err.response)===null||_err$response3===void 0?void 0:(_err$response3$data=_err$response3.data)===null||_err$response3$data===void 0?void 0:_err$response3$data.error)||'An error occurred while updating profile. Please try again.');throw err;}};// For demo purposes - bypass authentication\nconst setBypassAuth=userData=>{// Create a mock token\nconst mockToken='mock-bypass-token-'+Date.now();// Save token and set user\nlocalStorage.setItem('token',mockToken);setToken(mockToken);setCurrentUser(userData);// Set up mock auth header\napi.setAuthToken(mockToken);};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{currentUser,token,authLoading,error,register,login,logout,updateProfile,setBypassAuth,isAuthenticated:!!token},children:children});};export default AuthContext;","map":{"version":3,"names":["React","createContext","useState","useEffect","useContext","useNavigate","api","jsx","_jsx","AuthContext","useAuth","AuthProvider","_ref","children","currentUser","setCurrentUser","token","setToken","localStorage","getItem","authLoading","setAuthLoading","error","setError","navigate","checkLoggedIn","setAuthToken","response","get","data","user","err","console","removeItem","register","userData","post","setItem","_err$response","_err$response$data","login","credentials","_err$response2","_err$response2$data","logout","removeAuthToken","updateProfile","profileData","put","_err$response3","_err$response3$data","setBypassAuth","mockToken","Date","now","Provider","value","isAuthenticated"],"sources":["/home/toebot/dog-services-saas/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect, useContext } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport api from '../services/api';\n\nconst AuthContext = createContext();\n\nexport const useAuth = () => useContext(AuthContext);\n\nexport const AuthProvider = ({ children }) => {\n  const [currentUser, setCurrentUser] = useState(null);\n  const [token, setToken] = useState(localStorage.getItem('token') || null);\n  const [authLoading, setAuthLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const navigate = useNavigate();\n\n  // Check if user is already logged in on mount\n  useEffect(() => {\n    const checkLoggedIn = async () => {\n      if (token) {\n        try {\n          // Set the token in the API headers\n          api.setAuthToken(token);\n          \n          // Get user info\n          const response = await api.get('/users/me');\n          setCurrentUser(response.data.user);\n        } catch (err) {\n          console.error('Authentication error:', err);\n          // Clear invalid token\n          localStorage.removeItem('token');\n          setToken(null);\n          setCurrentUser(null);\n        }\n      }\n      setAuthLoading(false);\n    };\n\n    checkLoggedIn();\n  }, [token]);\n\n  // Register user\n  const register = async (userData) => {\n    try {\n      setError(null);\n      setAuthLoading(true);\n      \n      const response = await api.post('/auth/register', userData);\n      \n      // Save token and set user\n      localStorage.setItem('token', response.data.token);\n      setToken(response.data.token);\n      setCurrentUser(response.data.user);\n      \n      // Set token in API headers\n      api.setAuthToken(response.data.token);\n      \n      setAuthLoading(false);\n      return response.data;\n    } catch (err) {\n      setAuthLoading(false);\n      setError(\n        err.response?.data?.error || \n        'An error occurred during registration. Please try again.'\n      );\n      throw err;\n    }\n  };\n\n  // Login user\n  const login = async (credentials) => {\n    try {\n      setError(null);\n      setAuthLoading(true);\n      \n      // In a real production app, this would make an actual API call\n      // For development purposes, we're providing a bypass option\n      \n      const response = await api.post('/auth/login', credentials);\n      \n      // Save token and set user\n      localStorage.setItem('token', response.data.token);\n      setToken(response.data.token);\n      setCurrentUser(response.data.user);\n      \n      // Set token in API headers\n      api.setAuthToken(response.data.token);\n      \n      setAuthLoading(false);\n      return response.data;\n    } catch (err) {\n      setAuthLoading(false);\n      setError(\n        err.response?.data?.error || \n        'Invalid credentials. Please try again.'\n      );\n      throw err;\n    }\n  };\n\n  // Logout user\n  const logout = () => {\n    localStorage.removeItem('token');\n    setToken(null);\n    setCurrentUser(null);\n    api.removeAuthToken();\n    navigate('/login');\n  };\n\n  // Update user profile\n  const updateProfile = async (profileData) => {\n    try {\n      setError(null);\n      setAuthLoading(true);\n      \n      const response = await api.put('/users/profile', profileData);\n      \n      setCurrentUser({\n        ...currentUser,\n        ...response.data.user\n      });\n      \n      setAuthLoading(false);\n      return response.data;\n    } catch (err) {\n      setAuthLoading(false);\n      setError(\n        err.response?.data?.error || \n        'An error occurred while updating profile. Please try again.'\n      );\n      throw err;\n    }\n  };\n\n  // For demo purposes - bypass authentication\n  const setBypassAuth = (userData) => {\n    // Create a mock token\n    const mockToken = 'mock-bypass-token-' + Date.now();\n    \n    // Save token and set user\n    localStorage.setItem('token', mockToken);\n    setToken(mockToken);\n    setCurrentUser(userData);\n    \n    // Set up mock auth header\n    api.setAuthToken(mockToken);\n  };\n\n  return (\n    <AuthContext.Provider\n      value={{\n        currentUser,\n        token,\n        authLoading,\n        error,\n        register,\n        login,\n        logout,\n        updateProfile,\n        setBypassAuth,\n        isAuthenticated: !!token,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport default AuthContext;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}